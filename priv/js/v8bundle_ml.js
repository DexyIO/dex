require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],2:[function(require,module,exports){},{}],3:[function(require,module,exports){(function(global){"use strict";var buffer=require("buffer");var Buffer=buffer.Buffer;var SlowBuffer=buffer.SlowBuffer;var MAX_LEN=buffer.kMaxLength||2147483647;exports.alloc=function alloc(size,fill,encoding){if(typeof Buffer.alloc==="function"){return Buffer.alloc(size,fill,encoding)}if(typeof encoding==="number"){throw new TypeError("encoding must not be number")}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}var enc=encoding;var _fill=fill;if(_fill===undefined){enc=undefined;_fill=0}var buf=new Buffer(size);if(typeof _fill==="string"){var fillBuf=new Buffer(_fill,enc);var flen=fillBuf.length;var i=-1;while(++i<size){buf[i]=fillBuf[i%flen]}}else{buf.fill(_fill)}return buf};exports.allocUnsafe=function allocUnsafe(size){if(typeof Buffer.allocUnsafe==="function"){return Buffer.allocUnsafe(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}return new Buffer(size)};exports.from=function from(value,encodingOrOffset,length){if(typeof Buffer.from==="function"&&(!global.Uint8Array||Uint8Array.from!==Buffer.from)){return Buffer.from(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof value==="string"){return new Buffer(value,encodingOrOffset)}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){var offset=encodingOrOffset;if(arguments.length===1){return new Buffer(value)}if(typeof offset==="undefined"){offset=0}var len=length;if(typeof len==="undefined"){len=value.byteLength-offset}if(offset>=value.byteLength){throw new RangeError("'offset' is out of bounds")}if(len>value.byteLength-offset){throw new RangeError("'length' is out of bounds")}return new Buffer(value.slice(offset,offset+len))}if(Buffer.isBuffer(value)){var out=new Buffer(value.length);value.copy(out,0,0,value.length);return out}if(value){if(Array.isArray(value)||typeof ArrayBuffer!=="undefined"&&value.buffer instanceof ArrayBuffer||"length"in value){return new Buffer(value)}if(value.type==="Buffer"&&Array.isArray(value.data)){return new Buffer(value.data)}}throw new TypeError("First argument must be a string, Buffer, "+"ArrayBuffer, Array, or array-like object.")};exports.allocUnsafeSlow=function allocUnsafeSlow(size){if(typeof Buffer.allocUnsafeSlow==="function"){return Buffer.allocUnsafeSlow(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>=MAX_LEN){throw new RangeError("size is too large")}return new SlowBuffer(size)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{buffer:4}],4:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){
this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":1,ieee754:7,isarray:10}],5:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":9}],6:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],7:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],8:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],9:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],10:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],11:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports=nextTick}else{module.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:12}],12:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],13:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":14}],14:[function(require,module,exports){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args");var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":16,"./_stream_writable":18,"core-util-is":5,inherits:8,"process-nextick-args":11}],15:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":17,"core-util-is":5,inherits:8}],16:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");var Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var BufferList=require("./internal/streams/BufferList");var StringDecoder;util.inherits(Readable,Stream);function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function"){return emitter.prependListener(event,fn)}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}}function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=bufferShim.from(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;if(state.decoder&&!addToFront&&!encoding){chunk=state.decoder.write(chunk);skipAdd=!state.objectMode&&chunk.length===0}if(!addToFront)state.reading=false;if(!skipAdd){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}else{state.length-=n}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit("unpipe",this)}return this}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev==="readable"){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;state.awaitDrain=0;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){
var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=bufferShim.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":14,"./internal/streams/BufferList":19,_process:12,buffer:4,"buffer-shims":3,"core-util-is":5,events:6,inherits:8,isarray:10,"process-nextick-args":11,"string_decoder/":25,util:2}],17:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er,data){done(stream,er,data)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!==null&&data!==undefined)stream.push(data);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":14,"core-util-is":5,inherits:8}],18:[function(require,module,exports){(function(process){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args");var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Duplex;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=bufferShim.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;while(entry){buffer[count]=entry;entry=entry.next;count+=1}doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(err){var entry=_this.entry;_this.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=_this}else{state.corkedRequestsFree=_this}}}}).call(this,require("_process"))},{"./_stream_duplex":14,_process:12,buffer:4,"buffer-shims":3,"core-util-is":5,events:6,inherits:8,"process-nextick-args":11,"util-deprecate":26}],19:[function(require,module,exports){"use strict";var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");module.exports=BufferList;function BufferList(){this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function(n){if(this.length===0)return bufferShim.alloc(0);if(this.length===1)return this.head.data;var ret=bufferShim.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){p.data.copy(ret,i);i+=p.data.length;p=p.next}return ret}},{buffer:4,"buffer-shims":3}],20:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":15}],21:[function(require,module,exports){(function(process){var Stream=function(){try{return require("st"+"ream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream||exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"&&Stream){module.exports=Stream}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":14,"./lib/_stream_passthrough.js":15,"./lib/_stream_readable.js":16,"./lib/_stream_transform.js":17,"./lib/_stream_writable.js":18,_process:12}],22:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":17}],23:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":18}],24:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:6,inherits:8,"readable-stream/duplex.js":13,"readable-stream/passthrough.js":20,"readable-stream/readable.js":21,"readable-stream/transform.js":22,"readable-stream/writable.js":23}],25:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:4}],26:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],27:[function(require,module,exports){var _=require("underscore")._;function testPartition(classifierConst,opts,trainOpts,trainSet,testSet){var classifier=new classifierConst(opts);var beginTrain=Date.now();var trainingStats=classifier.train(trainSet,trainOpts);var beginTest=Date.now();var testStats=classifier.test(testSet);var endTest=Date.now();var stats=_(testStats).extend({trainTime:beginTest-beginTrain,testTime:endTest-beginTest,iterations:trainingStats.iterations,trainError:trainingStats.error,learningRate:trainOpts.learningRate,hidden:classifier.hiddenSizes,network:classifier.toJSON()});return stats}module.exports=function crossValidate(classifierConst,data,opts,trainOpts,k){k=k||4;var size=data.length/k;data=_(data).sortBy(function(){return Math.random()});var avgs={error:0,trainTime:0,testTime:0,iterations:0,trainError:0};var stats={truePos:0,trueNeg:0,falsePos:0,falseNeg:0,total:0};var misclasses=[];var results=_.range(k).map(function(i){var dclone=_(data).clone();var testSet=dclone.splice(i*size,size);var trainSet=dclone;var result=testPartition(classifierConst,opts,trainOpts,trainSet,testSet);_(avgs).each(function(sum,stat){avgs[stat]=sum+result[stat]});_(stats).each(function(sum,stat){stats[stat]=sum+result[stat]});misclasses.push(result.misclasses);return result});_(avgs).each(function(sum,i){avgs[i]=sum/k});stats.precision=stats.truePos/(stats.truePos+stats.falsePos);stats.recall=stats.truePos/(stats.truePos+stats.falseNeg);stats.accuracy=(stats.trueNeg+stats.truePos)/stats.total;stats.testSize=size;stats.trainSize=data.length-size;return{avgs:avgs,stats:stats,sets:results,misclasses:_(misclasses).flatten()}}},{underscore:43}],28:[function(require,module,exports){var _=require("underscore");function buildLookup(hashes){var hash=_(hashes).reduce(function(memo,hash){return _(memo).extend(hash)},{});return lookupFromHash(hash)}function lookupFromHash(hash){var lookup={};var index=0;for(var i in hash){lookup[i]=index++}return lookup}function toArray(lookup,hash){var array=[];for(var i in lookup){array[lookup[i]]=hash[i]||0}return array}function toHash(lookup,array){var hash={};for(var i in lookup){hash[i]=array[lookup[i]]}return hash}function lookupFromArray(array){var lookup={};var z=0;var i=array.length;while(i-- >0){lookup[array[i]]=z++}return lookup}module.exports={buildLookup:buildLookup,lookupFromHash:lookupFromHash,toArray:toArray,toHash:toHash,lookupFromArray:lookupFromArray}},{underscore:43}],29:[function(require,module,exports){var _=require("underscore"),lookup=require("./lookup"),Writable=require("stream").Writable,inherits=require("inherits");var NeuralNetwork=function(options){options=options||{};this.learningRate=options.learningRate||.3;this.momentum=options.momentum||.1;this.hiddenSizes=options.hiddenLayers;this.binaryThresh=options.binaryThresh||.5};NeuralNetwork.prototype={initialize:function(sizes){this.sizes=sizes;this.outputLayer=this.sizes.length-1;this.biases=[];this.weights=[];this.outputs=[];this.deltas=[];this.changes=[];this.errors=[];for(var layer=0;layer<=this.outputLayer;layer++){var size=this.sizes[layer];this.deltas[layer]=zeros(size);this.errors[layer]=zeros(size);this.outputs[layer]=zeros(size);if(layer>0){this.biases[layer]=randos(size);this.weights[layer]=new Array(size);this.changes[layer]=new Array(size);for(var node=0;node<size;node++){var prevSize=this.sizes[layer-1];this.weights[layer][node]=randos(prevSize);this.changes[layer][node]=zeros(prevSize)}}}},run:function(input){if(this.inputLookup){input=lookup.toArray(this.inputLookup,input)}var output=this.runInput(input);if(this.outputLookup){output=lookup.toHash(this.outputLookup,output)}return output},runInput:function(input){this.outputs[0]=input;for(var layer=1;layer<=this.outputLayer;layer++){for(var node=0;node<this.sizes[layer];node++){var weights=this.weights[layer][node];var sum=this.biases[layer][node];for(var k=0;k<weights.length;k++){sum+=weights[k]*input[k]}this.outputs[layer][node]=1/(1+Math.exp(-sum))}var output=input=this.outputs[layer]}return output},likely:function(input){var output=this.run(input);var maxProp=null;var maxValue=-1;for(var prop in output){if(output.hasOwnProperty(prop)){var value=output[prop];if(value>maxValue){maxProp=prop;maxValue=value}}}return maxProp},train:function(data,options){data=this.formatData(data);options=options||{};var iterations=options.iterations||2e4;var errorThresh=options.errorThresh||.005;var log=options.log?_.isFunction(options.log)?options.log:console.log:false;var logPeriod=options.logPeriod||10;var learningRate=options.learningRate||this.learningRate||.3;var callback=options.callback;var callbackPeriod=options.callbackPeriod||10;var inputSize=data[0].input.length;var outputSize=data[0].output.length;var hiddenSizes=this.hiddenSizes;if(!hiddenSizes){hiddenSizes=[Math.max(3,Math.floor(inputSize/2))]}var sizes=_([inputSize,hiddenSizes,outputSize]).flatten();this.initialize(sizes);var error=1;for(var i=0;i<iterations&&error>errorThresh;i++){var sum=0;for(var j=0;j<data.length;j++){var err=this.trainPattern(data[j].input,data[j].output,learningRate);sum+=err}error=sum/data.length;if(log&&i%logPeriod==0){log("iterations:",i,"training error:",error)}if(callback&&i%callbackPeriod==0){callback({error:error,iterations:i})}}return{error:error,iterations:i}},trainPattern:function(input,target,learningRate){learningRate=learningRate||this.learningRate;this.runInput(input);this.calculateDeltas(target);this.adjustWeights(learningRate);var error=mse(this.errors[this.outputLayer]);return error},calculateDeltas:function(target){for(var layer=this.outputLayer;layer>=0;layer--){for(var node=0;node<this.sizes[layer];node++){var output=this.outputs[layer][node];var error=0;if(layer==this.outputLayer){error=target[node]-output}else{var deltas=this.deltas[layer+1];for(var k=0;k<deltas.length;k++){error+=deltas[k]*this.weights[layer+1][k][node]}}this.errors[layer][node]=error;this.deltas[layer][node]=error*output*(1-output)}}},adjustWeights:function(learningRate){for(var layer=1;layer<=this.outputLayer;layer++){var incoming=this.outputs[layer-1];for(var node=0;node<this.sizes[layer];node++){var delta=this.deltas[layer][node];for(var k=0;k<incoming.length;k++){var change=this.changes[layer][node][k];change=learningRate*delta*incoming[k]+this.momentum*change;this.changes[layer][node][k]=change;this.weights[layer][node][k]+=change}this.biases[layer][node]+=learningRate*delta}}},formatData:function(data){if(!_.isArray(data)){var tmp=[];tmp.push(data);data=tmp}var datum=data[0].input;if(!_(datum).isArray()&&!(datum instanceof Float64Array)){if(!this.inputLookup){this.inputLookup=lookup.buildLookup(_(data).pluck("input"))}data=data.map(function(datum){var array=lookup.toArray(this.inputLookup,datum.input);return _(_(datum).clone()).extend({input:array})},this)}if(!_(data[0].output).isArray()){if(!this.outputLookup){this.outputLookup=lookup.buildLookup(_(data).pluck("output"))}data=data.map(function(datum){var array=lookup.toArray(this.outputLookup,datum.output);return _(_(datum).clone()).extend({output:array})},this)}return data},test:function(data){data=this.formatData(data);var isBinary=data[0].output.length==1;var falsePos=0,falseNeg=0,truePos=0,trueNeg=0;var misclasses=[];var sum=0;for(var i=0;i<data.length;i++){var output=this.runInput(data[i].input);var target=data[i].output;var actual,expected;if(isBinary){actual=output[0]>this.binaryThresh?1:0;expected=target[0]}else{actual=output.indexOf(_(output).max());expected=target.indexOf(_(target).max())}if(actual!=expected){var misclass=data[i];_(misclass).extend({actual:actual,expected:expected});misclasses.push(misclass)}if(isBinary){if(actual==0&&expected==0){trueNeg++}else if(actual==1&&expected==1){truePos++}else if(actual==0&&expected==1){falseNeg++}else if(actual==1&&expected==0){falsePos++}}var errors=output.map(function(value,i){return target[i]-value});sum+=mse(errors)}var error=sum/data.length;var stats={error:error,misclasses:misclasses};if(isBinary){_(stats).extend({trueNeg:trueNeg,truePos:truePos,falseNeg:falseNeg,falsePos:falsePos,total:data.length,precision:truePos/(truePos+falsePos),recall:truePos/(truePos+falseNeg),accuracy:(trueNeg+truePos)/data.length})}return stats},toJSON:function(){var layers=[];for(var layer=0;layer<=this.outputLayer;layer++){layers[layer]={};var nodes;if(layer==0&&this.inputLookup){nodes=_(this.inputLookup).keys()}else if(layer==this.outputLayer&&this.outputLookup){nodes=_(this.outputLookup).keys()}else{nodes=_.range(0,this.sizes[layer])}for(var j=0;j<nodes.length;j++){var node=nodes[j];layers[layer][node]={};if(layer>0){layers[layer][node].bias=this.biases[layer][j];layers[layer][node].weights={};for(var k in layers[layer-1]){var index=k;if(layer==1&&this.inputLookup){index=this.inputLookup[k]}layers[layer][node].weights[k]=this.weights[layer][j][index]}}}}return{layers:layers,outputLookup:!!this.outputLookup,inputLookup:!!this.inputLookup}},fromJSON:function(json){var size=json.layers.length;this.outputLayer=size-1;this.sizes=new Array(size);this.weights=new Array(size);this.biases=new Array(size);this.outputs=new Array(size);for(var i=0;i<=this.outputLayer;i++){var layer=json.layers[i];
if(i==0&&(!layer[0]||json.inputLookup)){this.inputLookup=lookup.lookupFromHash(layer)}else if(i==this.outputLayer&&(!layer[0]||json.outputLookup)){this.outputLookup=lookup.lookupFromHash(layer)}var nodes=_(layer).keys();this.sizes[i]=nodes.length;this.weights[i]=[];this.biases[i]=[];this.outputs[i]=[];for(var j in nodes){var node=nodes[j];this.biases[i][j]=layer[node].bias;this.weights[i][j]=_(layer[node].weights).toArray()}}return this},toFunction:function(){var json=this.toJSON();return new Function("input","  var net = "+JSON.stringify(json)+";\n\n  for (var i = 1; i < net.layers.length; i++) {\n    var layer = net.layers[i];\n    var output = {};\n    \n    for (var id in layer) {\n      var node = layer[id];\n      var sum = node.bias;\n      \n      for (var iid in node.weights) {\n        sum += node.weights[iid] * input[iid];\n      }\n      output[id] = (1 / (1 + Math.exp(-sum)));\n    }\n    input = output;\n  }\n  return output;")},createTrainStream:function(opts){opts=opts||{};opts.neuralNetwork=this;this.trainStream=new TrainStream(opts);return this.trainStream}};function randomWeight(){return Math.random()*.4-.2}function zeros(size){var array=new Array(size);for(var i=0;i<size;i++){array[i]=0}return array}function randos(size){var array=new Array(size);for(var i=0;i<size;i++){array[i]=randomWeight()}return array}function mse(errors){var sum=0;for(var i=0;i<errors.length;i++){sum+=Math.pow(errors[i],2)}return sum/errors.length}exports.NeuralNetwork=NeuralNetwork;function TrainStream(opts){Writable.call(this,{objectMode:true});opts=opts||{};if(!opts.neuralNetwork){throw new Error("no neural network specified")}this.neuralNetwork=opts.neuralNetwork;this.dataFormatDetermined=false;this.inputKeys=[];this.outputKeys=[];this.i=0;this.iterations=opts.iterations||2e4;this.errorThresh=opts.errorThresh||.005;this.log=opts.log?_.isFunction(opts.log)?opts.log:console.log:false;this.logPeriod=opts.logPeriod||10;this.callback=opts.callback;this.callbackPeriod=opts.callbackPeriod||10;this.floodCallback=opts.floodCallback;this.doneTrainingCallback=opts.doneTrainingCallback;this.size=0;this.count=0;this.sum=0;this.on("finish",this.finishStreamIteration);return this}inherits(TrainStream,Writable);TrainStream.prototype._write=function(chunk,enc,next){if(!chunk){this.emit("finish");return next()}if(!this.dataFormatDetermined){this.size++;this.inputKeys=_.union(this.inputKeys,_.keys(chunk.input));this.outputKeys=_.union(this.outputKeys,_.keys(chunk.output));this.firstDatum=this.firstDatum||chunk;return next()}this.count++;var data=this.neuralNetwork.formatData(chunk);this.trainDatum(data[0]);next()};TrainStream.prototype.trainDatum=function(datum){var err=this.neuralNetwork.trainPattern(datum.input,datum.output);this.sum+=err};TrainStream.prototype.finishStreamIteration=function(){if(this.dataFormatDetermined&&this.size!==this.count){console.log("This iteration's data length was different from the first.")}if(!this.dataFormatDetermined){this.neuralNetwork.inputLookup=lookup.lookupFromArray(this.inputKeys);if(!_.isArray(this.firstDatum.output)){this.neuralNetwork.outputLookup=lookup.lookupFromArray(this.outputKeys)}var data=this.neuralNetwork.formatData(this.firstDatum);var inputSize=data[0].input.length;var outputSize=data[0].output.length;var hiddenSizes=this.hiddenSizes;if(!hiddenSizes){hiddenSizes=[Math.max(3,Math.floor(inputSize/2))]}var sizes=_([inputSize,hiddenSizes,outputSize]).flatten();this.dataFormatDetermined=true;this.neuralNetwork.initialize(sizes);if(typeof this.floodCallback==="function"){this.floodCallback()}return}var error=this.sum/this.size;if(this.log&&this.i%this.logPeriod==0){this.log("iterations:",this.i,"training error:",error)}if(this.callback&&this.i%this.callbackPeriod==0){this.callback({error:error,iterations:this.i})}this.sum=0;this.count=0;this.i++;if(this.i<this.iterations&&error>this.errorThresh){if(typeof this.floodCallback==="function"){return this.floodCallback()}}else{if(typeof this.doneTrainingCallback==="function"){return this.doneTrainingCallback({error:error,iterations:this.i})}}}},{"./lookup":28,inherits:33,stream:24,underscore:43}],30:[function(require,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],31:[function(require,module,exports){module.exports=htanPrime;function htanPrime(z){return 1-Math.pow((Math.exp(2*z)-1)/(Math.exp(2*z)+1),2)}},{}],32:[function(require,module,exports){module.exports=htan;function htan(z){return(Math.exp(2*z)-1)/(Math.exp(2*z)+1)}},{}],33:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{dup:8}],34:[function(require,module,exports){module.exports=Matrix;function Matrix(opts){if(!(this instanceof Matrix))return new Matrix(opts);if(Array.isArray(opts)){this.numRows=opts.length;this.numCols=opts[0].length;for(var i=0;i<this.numRows;i++){this[i]=[];for(var j=0;j<this.numCols;j++){this[i][j]=opts[i][j]}}}else if(typeof opts==="object"){this.numRows=opts.rows;this.numCols=opts.columns;for(var i=0;i<this.numRows;i++){this[i]=[];for(var j=0;j<this.numCols;j++){if(typeof opts.values==="function"){this[i][j]=opts.values()}else if(typeof opts.values==="number"){this[i][j]=opts.values}else{this[i][j]=0}}}}else{throw new Error("You must supply an object or an array")}this.dimensions=[this.numRows,this.numCols]}Matrix.add=function(m1,m2){if(m1.numRows!==m2.numRows||m1.numCols!==m2.numCols){throw new Error("You can only add matrices with equal dimensions")}var result=new Matrix({rows:m1.numRows,columns:m1.numCols});for(var i=0;i<m1.numRows;i++){for(var j=0;j<m1.numCols;j++){result[i][j]=m1[i][j]+m2[i][j]}}return result};Matrix.subtract=function(m1,m2){if(m1.numRows!==m2.numRows||m1.numCols!==m2.numCols){throw new Error("You can only subtract matrices with equal dimensions")}var result=new Matrix({rows:m1.numRows,columns:m1.numCols});for(var i=0;i<m1.numRows;i++){for(var j=0;j<m1.numCols;j++){result[i][j]=m1[i][j]-m2[i][j]}}return result};Matrix.multiply=function(m1,m2){var result=Matrix({rows:m2.numRows,columns:m1.numCols});for(var i=0;i<m2.numRows;i++){result[i]=[];for(var j=0;j<m1.numCols;j++){var sum=0;for(var k=0;k<m1.numRows;k++){sum+=m1[k][j]*m2[i][k]}result[i][j]=sum}}return result};Matrix.multiplyScalar=function(m1,num){var result=Matrix({rows:m1.numRows,columns:m1.numCols});for(var i=0;i<m1.numRows;i++){for(var j=0;j<m1.numCols;j++){result[i][j]=m1[i][j]*num}}return result};Matrix.multiplyElements=function(m1,m2){var result=Matrix({rows:m1.numRows,columns:m1.numCols});for(var i=0;i<m1.numRows;i++){result[i]=[];for(var j=0;j<m1[i].length;j++){result[i][j]=m1[i][j]*m2[i][j]}}return result};Matrix.prototype.transpose=function(){var result=Matrix({rows:this.numCols,columns:this.numRows});for(var i=0;i<this.numCols;i++){result[i]=[];for(var j=0;j<this.numRows;j++){result[i][j]=this[j][i]}}return result};Matrix.prototype.transform=function(fn){var result=Matrix({rows:this.numRows,columns:this.numCols});for(var i=0;i<result.numRows;i++){for(var j=0;j<result.numCols;j++){result[i][j]=fn(this[i][j])}}return result}},{}],35:[function(require,module,exports){module.exports=sample;function sample(){return Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random())}},{}],36:[function(require,module,exports){module.exports=sigmoidPrime;function sigmoidPrime(z){return Math.exp(-z)/Math.pow(1+Math.exp(-z),2)}},{}],37:[function(require,module,exports){module.exports=sigmoid;function sigmoid(z){return 1/(1+Math.exp(-z))}},{}],38:[function(require,module,exports){var Layer=require("./layer"),Network=require("./network"),Trainer=require("./trainer");var Architect={Perceptron:function Perceptron(){var args=Array.prototype.slice.call(arguments);if(args.length<3)throw new Error("not enough layers (minimum 3) !!");var inputs=args.shift();var outputs=args.pop();var layers=args;var input=new Layer(inputs);var hidden=[];var output=new Layer(outputs);var previous=input;for(var level in layers){var size=layers[level];var layer=new Layer(size);hidden.push(layer);previous.project(layer);previous=layer}previous.project(output);this.set({input:input,hidden:hidden,output:output});this.trainer=new Trainer(this)},LSTM:function LSTM(){var args=Array.prototype.slice.call(arguments);if(args.length<3)throw new Error("not enough layers (minimum 3) !!");var last=args.pop();var option={peepholes:Layer.connectionType.ALL_TO_ALL,hiddenToHidden:false,outputToHidden:false,outputToGates:false,inputToOutput:true};if(typeof last!="number"){var outputs=args.pop();if(last.hasOwnProperty("peepholes"))option.peepholes=last.peepholes;if(last.hasOwnProperty("hiddenToHidden"))option.hiddenToHidden=last.hiddenToHidden;if(last.hasOwnProperty("outputToHidden"))option.outputToHidden=last.outputToHidden;if(last.hasOwnProperty("outputToGates"))option.outputToGates=last.outputToGates;if(last.hasOwnProperty("inputToOutput"))option.inputToOutput=last.inputToOutput}else var outputs=last;var inputs=args.shift();var layers=args;var inputLayer=new Layer(inputs);var hiddenLayers=[];var outputLayer=new Layer(outputs);var previous=null;for(var layer in layers){var size=layers[layer];var inputGate=new Layer(size).set({bias:1});var forgetGate=new Layer(size).set({bias:1});var memoryCell=new Layer(size);var outputGate=new Layer(size).set({bias:1});hiddenLayers.push(inputGate);hiddenLayers.push(forgetGate);hiddenLayers.push(memoryCell);hiddenLayers.push(outputGate);var input=inputLayer.project(memoryCell);inputLayer.project(inputGate);inputLayer.project(forgetGate);inputLayer.project(outputGate);if(previous!=null){var cell=previous.project(memoryCell);previous.project(inputGate);previous.project(forgetGate);previous.project(outputGate)}var output=memoryCell.project(outputLayer);var self=memoryCell.project(memoryCell);if(option.hiddenToHidden)memoryCell.project(memoryCell,Layer.connectionType.ALL_TO_ELSE);if(option.outputToHidden)outputLayer.project(memoryCell);if(option.outputToGates){outputLayer.project(inputGate);outputLayer.project(outputGate);outputLayer.project(forgetGate)}memoryCell.project(inputGate,option.peepholes);memoryCell.project(forgetGate,option.peepholes);memoryCell.project(outputGate,option.peepholes);inputGate.gate(input,Layer.gateType.INPUT);forgetGate.gate(self,Layer.gateType.ONE_TO_ONE);outputGate.gate(output,Layer.gateType.OUTPUT);if(previous!=null)inputGate.gate(cell,Layer.gateType.INPUT);previous=memoryCell}if(option.inputToOutput)inputLayer.project(outputLayer);this.set({input:inputLayer,hidden:hiddenLayers,output:outputLayer});this.trainer=new Trainer(this)},Liquid:function Liquid(inputs,hidden,outputs,connections,gates){var inputLayer=new Layer(inputs);var hiddenLayer=new Layer(hidden);var outputLayer=new Layer(outputs);var neurons=hiddenLayer.neurons();var connectionList=[];for(var i=0;i<connections;i++){var from=Math.random()*neurons.length|0;var to=Math.random()*neurons.length|0;var connection=neurons[from].project(neurons[to]);connectionList.push(connection)}for(var j=0;j<gates;j++){var gater=Math.random()*neurons.length|0;var connection=Math.random()*connectionList.length|0;neurons[gater].gate(connectionList[connection])}inputLayer.project(hiddenLayer);hiddenLayer.project(outputLayer);this.set({input:inputLayer,hidden:[hiddenLayer],output:outputLayer});this.trainer=new Trainer(this)},Hopfield:function Hopfield(size){var inputLayer=new Layer(size);var outputLayer=new Layer(size);inputLayer.project(outputLayer,Layer.connectionType.ALL_TO_ALL);this.set({input:inputLayer,hidden:[],output:outputLayer});var trainer=new Trainer(this);var proto=Architect.Hopfield.prototype;proto.learn=proto.learn||function(patterns){var set=[];for(var p in patterns)set.push({input:patterns[p],output:patterns[p]});return trainer.train(set,{iterations:5e5,error:5e-5,rate:1})};proto.feed=proto.feed||function(pattern){var output=this.activate(pattern);var pattern=[];for(var i in output)pattern[i]=output[i]>.5?1:0;return pattern}}};for(var architecture in Architect){Architect[architecture].prototype=new Network;Architect[architecture].prototype.constructor=Architect[architecture]}if(module)module.exports=Architect},{"./layer":39,"./network":40,"./trainer":42}],39:[function(require,module,exports){if(module)module.exports=Layer;var Neuron=require("./neuron"),Network=require("./network");function Layer(size,label){this.size=size|0;this.list=[];this.label=label||null;this.connectedTo=[];while(size--){var neuron=new Neuron;this.list.push(neuron)}}Layer.prototype={activate:function(input){var activations=[];if(typeof input!="undefined"){if(input.length!=this.size)throw new Error("INPUT size and LAYER size must be the same to activate!");for(var id in this.list){var neuron=this.list[id];var activation=neuron.activate(input[id]);activations.push(activation)}}else{for(var id in this.list){var neuron=this.list[id];var activation=neuron.activate();activations.push(activation)}}return activations},propagate:function(rate,target){if(typeof target!="undefined"){if(target.length!=this.size)throw new Error("TARGET size and LAYER size must be the same to propagate!");for(var id=this.list.length-1;id>=0;id--){var neuron=this.list[id];neuron.propagate(rate,target[id])}}else{for(var id=this.list.length-1;id>=0;id--){var neuron=this.list[id];neuron.propagate(rate)}}},project:function(layer,type,weights){if(layer instanceof Network)layer=layer.layers.input;if(layer instanceof Layer){if(!this.connected(layer))return new Layer.connection(this,layer,type,weights)}else throw new Error("Invalid argument, you can only project connections to LAYERS and NETWORKS!")},gate:function(connection,type){if(type==Layer.gateType.INPUT){if(connection.to.size!=this.size)throw new Error("GATER layer and CONNECTION.TO layer must be the same size in order to gate!");for(var id in connection.to.list){var neuron=connection.to.list[id];var gater=this.list[id];for(var input in neuron.connections.inputs){var gated=neuron.connections.inputs[input];if(gated.ID in connection.connections)gater.gate(gated)}}}else if(type==Layer.gateType.OUTPUT){if(connection.from.size!=this.size)throw new Error("GATER layer and CONNECTION.FROM layer must be the same size in order to gate!");for(var id in connection.from.list){var neuron=connection.from.list[id];var gater=this.list[id];for(var projected in neuron.connections.projected){var gated=neuron.connections.projected[projected];if(gated.ID in connection.connections)gater.gate(gated)}}}else if(type==Layer.gateType.ONE_TO_ONE){if(connection.size!=this.size)throw new Error("The number of GATER UNITS must be the same as the number of CONNECTIONS to gate!");for(var id in connection.list){var gater=this.list[id];var gated=connection.list[id];gater.gate(gated)}}connection.gatedfrom.push({layer:this,type:type})},selfconnected:function(){for(var id in this.list){var neuron=this.list[id];if(!neuron.selfconnected())return false}return true},connected:function(layer){var connections=0;for(var here in this.list){for(var there in layer.list){var from=this.list[here];var to=layer.list[there];var connected=from.connected(to);if(connected.type=="projected")connections++}}if(connections==this.size*layer.size)return Layer.connectionType.ALL_TO_ALL;connections=0;for(var neuron in this.list){var from=this.list[neuron];var to=layer.list[neuron];var connected=from.connected(to);if(connected.type=="projected")connections++}if(connections==this.size)return Layer.connectionType.ONE_TO_ONE},clear:function(){for(var id in this.list){var neuron=this.list[id];neuron.clear()}},reset:function(){for(var id in this.list){var neuron=this.list[id];neuron.reset()}},neurons:function(){return this.list},add:function(neuron){this.neurons[neuron.ID]=neuron||new Neuron;this.list.push(neuron);this.size++},set:function(options){options=options||{};for(var i in this.list){var neuron=this.list[i];if(options.label)neuron.label=options.label+"_"+neuron.ID;if(options.squash)neuron.squash=options.squash;if(options.bias)neuron.bias=options.bias}return this}};Layer.connection=function LayerConnection(fromLayer,toLayer,type,weights){this.ID=Layer.connection.uid();this.from=fromLayer;this.to=toLayer;this.selfconnection=toLayer==fromLayer;this.type=type;this.connections={};this.list=[];this.size=0;this.gatedfrom=[];if(typeof this.type=="undefined"){if(fromLayer==toLayer)this.type=Layer.connectionType.ONE_TO_ONE;else this.type=Layer.connectionType.ALL_TO_ALL}if(this.type==Layer.connectionType.ALL_TO_ALL||this.type==Layer.connectionType.ALL_TO_ELSE){for(var here in this.from.list){for(var there in this.to.list){var from=this.from.list[here];var to=this.to.list[there];if(this.type==Layer.connectionType.ALL_TO_ELSE&&from==to)continue;var connection=from.project(to,weights);this.connections[connection.ID]=connection;this.size=this.list.push(connection)}}}else if(this.type==Layer.connectionType.ONE_TO_ONE){for(var neuron in this.from.list){var from=this.from.list[neuron];var to=this.to.list[neuron];var connection=from.project(to,weights);this.connections[connection.ID]=connection;this.size=this.list.push(connection)}}fromLayer.connectedTo.push(this)};Layer.connectionType={};Layer.connectionType.ALL_TO_ALL="ALL TO ALL";Layer.connectionType.ONE_TO_ONE="ONE TO ONE";Layer.connectionType.ALL_TO_ELSE="ALL TO ELSE";Layer.gateType={};Layer.gateType.INPUT="INPUT";Layer.gateType.OUTPUT="OUTPUT";Layer.gateType.ONE_TO_ONE="ONE TO ONE";(function(){var connections=0;Layer.connection.uid=function(){return connections++}})()},{"./network":40,"./neuron":41}],40:[function(require,module,exports){if(module)module.exports=Network;var Neuron=require("./neuron"),Layer=require("./layer"),Trainer=require("./trainer");function Network(layers){if(typeof layers!="undefined"){this.layers=layers||{input:null,hidden:{},output:null};this.optimized=null}}Network.prototype={activate:function(input){if(this.optimized===false){this.layers.input.activate(input);for(var layer in this.layers.hidden)this.layers.hidden[layer].activate();return this.layers.output.activate()}else{if(this.optimized==null)this.optimize();return this.optimized.activate(input)}},propagate:function(rate,target){if(this.optimized===false){this.layers.output.propagate(rate,target);var reverse=[];for(var layer in this.layers.hidden)reverse.push(this.layers.hidden[layer]);reverse.reverse();for(var layer in reverse)reverse[layer].propagate(rate)}else{if(this.optimized==null)this.optimize();this.optimized.propagate(rate,target)}},project:function(unit,type,weights){if(this.optimized)this.optimized.reset();if(unit instanceof Network)return this.layers.output.project(unit.layers.input,type,weights);if(unit instanceof Layer)return this.layers.output.project(unit,type,weights);throw new Error("Invalid argument, you can only project connections to LAYERS and NETWORKS!")},gate:function(connection,type){if(this.optimized)this.optimized.reset();this.layers.output.gate(connection,type)},clear:function(){this.restore();var inputLayer=this.layers.input,outputLayer=this.layers.output;inputLayer.clear();for(var layer in this.layers.hidden){var hiddenLayer=this.layers.hidden[layer];hiddenLayer.clear()}outputLayer.clear();if(this.optimized)this.optimized.reset()},reset:function(){this.restore();var inputLayer=this.layers.input,outputLayer=this.layers.output;inputLayer.reset();for(var layer in this.layers.hidden){var hiddenLayer=this.layers.hidden[layer];hiddenLayer.reset()}outputLayer.reset();if(this.optimized)this.optimized.reset()},optimize:function(){var that=this;var optimized={};var neurons=this.neurons();for(var i in neurons){var neuron=neurons[i].neuron;var layer=neurons[i].layer;while(neuron.neuron)neuron=neuron.neuron;optimized=neuron.optimize(optimized,layer)}for(var i in optimized.propagation_sentences)optimized.propagation_sentences[i].reverse();optimized.propagation_sentences.reverse();var hardcode="";hardcode+="var F = Float64Array ? new Float64Array("+optimized.memory+") : []; ";for(var i in optimized.variables)hardcode+="F["+optimized.variables[i].id+"] = "+(optimized.variables[i].value||0)+"; ";hardcode+="var activate = function(input){\n";for(var i in optimized.inputs)hardcode+="F["+optimized.inputs[i]+"] = input["+i+"]; ";for(var currentLayer in optimized.activation_sentences){if(optimized.activation_sentences[currentLayer].length>0){for(var currentNeuron in optimized.activation_sentences[currentLayer]){hardcode+=optimized.activation_sentences[currentLayer][currentNeuron].join(" ");hardcode+=optimized.trace_sentences[currentLayer][currentNeuron].join(" ")}}}hardcode+=" var output = []; ";for(var i in optimized.outputs)hardcode+="output["+i+"] = F["+optimized.outputs[i]+"]; ";hardcode+="return output; }; ";hardcode+="var propagate = function(rate, target){\n";hardcode+="F["+optimized.variables.rate.id+"] = rate; ";for(var i in optimized.targets)hardcode+="F["+optimized.targets[i]+"] = target["+i+"]; ";for(var currentLayer in optimized.propagation_sentences)for(var currentNeuron in optimized.propagation_sentences[currentLayer])hardcode+=optimized.propagation_sentences[currentLayer][currentNeuron].join(" ")+" ";hardcode+=" };\n";hardcode+="var ownership = function(memoryBuffer){\nF = memoryBuffer;\nthis.memory = F;\n};\n";hardcode+="return {\nmemory: F,\nactivate: activate,\npropagate: propagate,\nownership: ownership\n};";hardcode=hardcode.split(";").join(";\n");var constructor=new Function(hardcode);var network=constructor();network.data={variables:optimized.variables,activate:optimized.activation_sentences,propagate:optimized.propagation_sentences,trace:optimized.trace_sentences,inputs:optimized.inputs,outputs:optimized.outputs,check_activation:this.activate,check_propagation:this.propagate};network.reset=function(){if(that.optimized){that.optimized=null;that.activate=network.data.check_activation;that.propagate=network.data.check_propagation}};this.optimized=network;this.activate=network.activate;this.propagate=network.propagate},restore:function(){if(!this.optimized)return;var optimized=this.optimized;var getValue=function(){var args=Array.prototype.slice.call(arguments);var unit=args.shift();var prop=args.pop();var id=prop+"_";for(var property in args)id+=args[property]+"_";id+=unit.ID;var memory=optimized.memory;var variables=optimized.data.variables;if(id in variables)return memory[variables[id].id];return 0};var list=this.neurons();var ids={};for(var i in list){var neuron=list[i].neuron;while(neuron.neuron)neuron=neuron.neuron;neuron.state=getValue(neuron,"state");neuron.old=getValue(neuron,"old");neuron.activation=getValue(neuron,"activation");neuron.bias=getValue(neuron,"bias");for(var input in neuron.trace.elegibility)neuron.trace.elegibility[input]=getValue(neuron,"trace","elegibility",input);for(var gated in neuron.trace.extended)for(var input in neuron.trace.extended[gated])neuron.trace.extended[gated][input]=getValue(neuron,"trace","extended",gated,input)}for(var i in list){var neuron=list[i].neuron;while(neuron.neuron)neuron=neuron.neuron;for(var j in neuron.connections.projected){var connection=neuron.connections.projected[j];connection.weight=getValue(connection,"weight");connection.gain=getValue(connection,"gain")}}},neurons:function(){var neurons=[];var inputLayer=this.layers.input.neurons(),outputLayer=this.layers.output.neurons();for(var neuron in inputLayer)neurons.push({neuron:inputLayer[neuron],layer:"input"});for(var layer in this.layers.hidden){var hiddenLayer=this.layers.hidden[layer].neurons();for(var neuron in hiddenLayer)neurons.push({neuron:hiddenLayer[neuron],layer:layer})}for(var neuron in outputLayer)neurons.push({neuron:outputLayer[neuron],layer:"output"});return neurons},inputs:function(){return this.layers.input.size},outputs:function(){return this.layers.output.size},set:function(layers){this.layers=layers;if(this.optimized)this.optimized.reset()},setOptimize:function(bool){this.restore();if(this.optimized)this.optimized.reset();this.optimized=bool?null:false},toJSON:function(ignoreTraces){this.restore();var list=this.neurons();var neurons=[];var connections=[];var ids={};for(var i in list){var neuron=list[i].neuron;while(neuron.neuron)neuron=neuron.neuron;ids[neuron.ID]=i;var copy={trace:{elegibility:{},extended:{}},state:neuron.state,old:neuron.old,activation:neuron.activation,bias:neuron.bias,layer:list[i].layer};copy.squash=neuron.squash==Neuron.squash.LOGISTIC?"LOGISTIC":neuron.squash==Neuron.squash.TANH?"TANH":neuron.squash==Neuron.squash.IDENTITY?"IDENTITY":neuron.squash==Neuron.squash.HLIM?"HLIM":null;neurons.push(copy)}for(var i in list){var neuron=list[i].neuron;while(neuron.neuron)neuron=neuron.neuron;for(var j in neuron.connections.projected){var connection=neuron.connections.projected[j];connections.push({from:ids[connection.from.ID],to:ids[connection.to.ID],weight:connection.weight,gater:connection.gater?ids[connection.gater.ID]:null})}if(neuron.selfconnected())connections.push({from:ids[neuron.ID],to:ids[neuron.ID],weight:neuron.selfconnection.weight,gater:neuron.selfconnection.gater?ids[neuron.selfconnection.gater.ID]:null})}return{neurons:neurons,connections:connections}},toDot:function(edgeConnection){if(!typeof edgeConnection)edgeConnection=false;var code="digraph nn {\n    rankdir = BT\n";var layers=[this.layers.input].concat(this.layers.hidden,this.layers.output);for(var layer in layers){for(var to in layers[layer].connectedTo){var connection=layers[layer].connectedTo[to];var layerTo=connection.to;var size=connection.size;var layerID=layers.indexOf(layers[layer]);var layerToID=layers.indexOf(layerTo);if(edgeConnection){if(connection.gatedfrom.length){var fakeNode="fake"+layerID+"_"+layerToID;code+="    "+fakeNode+' [label = "", shape = point, width = 0.01, height = 0.01]\n';code+="    "+layerID+" -> "+fakeNode+" [label = "+size+", arrowhead = none]\n";code+="    "+fakeNode+" -> "+layerToID+"\n"}else code+="    "+layerID+" -> "+layerToID+" [label = "+size+"]\n";for(var from in connection.gatedfrom){var layerfrom=connection.gatedfrom[from].layer;var layerfromID=layers.indexOf(layerfrom);code+="    "+layerfromID+" -> "+fakeNode+" [color = blue]\n"}}else{code+="    "+layerID+" -> "+layerToID+" [label = "+size+"]\n";for(var from in connection.gatedfrom){var layerfrom=connection.gatedfrom[from].layer;var layerfromID=layers.indexOf(layerfrom);code+="    "+layerfromID+" -> "+layerToID+" [color = blue]\n"}}}}code+="}\n";return{code:code,link:"https://chart.googleapis.com/chart?chl="+escape(code.replace("/ /g","+"))+"&cht=gv"}},standalone:function(){if(!this.optimized)this.optimize();var data=this.optimized.data;var activation="function (input) {\n";for(var i in data.inputs)activation+="F["+data.inputs[i]+"] = input["+i+"];\n";for(var neuron in data.activate){for(var sentence in data.activate[neuron])activation+=data.activate[neuron][sentence].join("")+"\n"}activation+="var output = [];\n";for(var i in data.outputs)activation+="output["+i+"] = F["+data.outputs[i]+"];\n";activation+="return output;\n}";var memory=activation.match(/F\[(\d+)\]/g);var dimension=0;var ids={};for(var address in memory){var tmp=memory[address].match(/\d+/)[0];if(!(tmp in ids)){ids[tmp]=dimension++}}var hardcode="F = {\n";for(var i in ids)hardcode+=ids[i]+": "+this.optimized.memory[i]+",\n";hardcode=hardcode.substring(0,hardcode.length-2)+"\n};\n";hardcode="var run = "+activation.replace(/F\[(\d+)]/g,function(index){return"F["+ids[index.match(/\d+/)[0]]+"]"}).replace("{\n","{\n"+hardcode+"")+";\n";hardcode+="return run";return new Function(hardcode)()},worker:function(memory,set,options){var workerOptions={};if(options)workerOptions=options;workerOptions.rate=options.rate||.2;workerOptions.iterations=options.iterations||1e5;workerOptions.error=options.error||.005;workerOptions.cost=options.cost||null;workerOptions.crossValidate=options.crossValidate||null;costFunction="var cost = "+(options&&options.cost||this.cost||Trainer.cost.MSE)+";\n";var workerFunction=Network.getWorkerSharedFunctions();workerFunction=workerFunction.replace(/var cost = options && options\.cost \|\| this\.cost \|\| Trainer\.cost\.MSE;/g,costFunction);workerFunction=workerFunction.replace("return results;",'postMessage({action: "done", message: results, memoryBuffer: F}, [F.buffer]);');workerFunction=workerFunction.replace("console.log('iterations', iterations, 'error', error, 'rate', currentRate)","postMessage({action: 'log', message: {\n"+"iterations: iterations,\n"+"error: error,\n"+"rate: currentRate\n"+"}\n"+"})");workerFunction=workerFunction.replace("abort = this.schedule.do({ error: error, iterations: iterations, rate: currentRate })","postMessage({action: 'schedule', message: {\n"+"iterations: iterations,\n"+"error: error,\n"+"rate: currentRate\n"+"}\n"+"})");if(!this.optimized)this.optimize();var hardcode="var inputs = "+this.optimized.data.inputs.length+";\n";hardcode+="var outputs = "+this.optimized.data.outputs.length+";\n";hardcode+="var F =  new Float64Array(["+this.optimized.memory.toString()+"]);\n";hardcode+="var activate = "+this.optimized.activate.toString()+";\n";hardcode+="var propagate = "+this.optimized.propagate.toString()+";\n";hardcode+="onmessage = function(e) {\n"+"if (e.data.action == 'startTraining') {\n"+"train("+JSON.stringify(set)+","+JSON.stringify(workerOptions)+");\n"+"}\n"+"}";var workerSourceCode=workerFunction+"\n"+hardcode;var blob=new Blob([workerSourceCode]);var blobURL=window.URL.createObjectURL(blob);return new Worker(blobURL)},clone:function(){return Network.fromJSON(this.toJSON())}};Network.getWorkerSharedFunctions=function(){if(typeof Network._SHARED_WORKER_FUNCTIONS!=="undefined")return Network._SHARED_WORKER_FUNCTIONS;var train_f=Trainer.prototype.train.toString();train_f=train_f.replace("function (set","function train(set")+"\n";var _trainSet_f=Trainer.prototype._trainSet.toString().replace(/this.network./g,"");_trainSet_f=_trainSet_f.replace("function (set","function _trainSet(set")+"\n";_trainSet_f=_trainSet_f.replace("this.crossValidate","crossValidate");_trainSet_f=_trainSet_f.replace("crossValidate = true","crossValidate = { }");var test_f=Trainer.prototype.test.toString().replace(/this.network./g,"");test_f=test_f.replace("function (set","function test(set")+"\n";return Network._SHARED_WORKER_FUNCTIONS=train_f+_trainSet_f+test_f};Network.fromJSON=function(json){var neurons=[];var layers={input:new Layer,hidden:[],output:new Layer};for(var i in json.neurons){var config=json.neurons[i];var neuron=new Neuron;neuron.trace.elegibility={};neuron.trace.extended={};neuron.state=config.state;neuron.old=config.old;neuron.activation=config.activation;neuron.bias=config.bias;neuron.squash=config.squash in Neuron.squash?Neuron.squash[config.squash]:Neuron.squash.LOGISTIC;
neurons.push(neuron);if(config.layer=="input")layers.input.add(neuron);else if(config.layer=="output")layers.output.add(neuron);else{if(typeof layers.hidden[config.layer]=="undefined")layers.hidden[config.layer]=new Layer;layers.hidden[config.layer].add(neuron)}}for(var i in json.connections){var config=json.connections[i];var from=neurons[config.from];var to=neurons[config.to];var weight=config.weight;var gater=neurons[config.gater];var connection=from.project(to,weight);if(gater)gater.gate(connection)}return new Network(layers)}},{"./layer":39,"./neuron":41,"./trainer":42}],41:[function(require,module,exports){if(module)module.exports=Neuron;function Neuron(){this.ID=Neuron.uid();this.label=null;this.connections={inputs:{},projected:{},gated:{}};this.error={responsibility:0,projected:0,gated:0};this.trace={elegibility:{},extended:{},influences:{}};this.state=0;this.old=0;this.activation=0;this.selfconnection=new Neuron.connection(this,this,0);this.squash=Neuron.squash.LOGISTIC;this.neighboors={};this.bias=Math.random()*.2-.1}Neuron.prototype={activate:function(input){if(typeof input!="undefined"){this.activation=input;this.derivative=0;this.bias=0;return this.activation}this.old=this.state;this.state=this.selfconnection.gain*this.selfconnection.weight*this.state+this.bias;for(var i in this.connections.inputs){var input=this.connections.inputs[i];this.state+=input.from.activation*input.weight*input.gain}this.activation=this.squash(this.state);this.derivative=this.squash(this.state,true);var influences=[];for(var id in this.trace.extended){var neuron=this.neighboors[id];var influence=neuron.selfconnection.gater==this?neuron.old:0;for(var incoming in this.trace.influences[neuron.ID]){influence+=this.trace.influences[neuron.ID][incoming].weight*this.trace.influences[neuron.ID][incoming].from.activation}influences[neuron.ID]=influence}for(var i in this.connections.inputs){var input=this.connections.inputs[i];this.trace.elegibility[input.ID]=this.selfconnection.gain*this.selfconnection.weight*this.trace.elegibility[input.ID]+input.gain*input.from.activation;for(var id in this.trace.extended){var xtrace=this.trace.extended[id];var neuron=this.neighboors[id];var influence=influences[neuron.ID];xtrace[input.ID]=neuron.selfconnection.gain*neuron.selfconnection.weight*xtrace[input.ID]+this.derivative*this.trace.elegibility[input.ID]*influence}}for(var connection in this.connections.gated){this.connections.gated[connection].gain=this.activation}return this.activation},propagate:function(rate,target){var error=0;var isOutput=typeof target!="undefined";if(isOutput)this.error.responsibility=this.error.projected=target-this.activation;else{for(var id in this.connections.projected){var connection=this.connections.projected[id];var neuron=connection.to;error+=neuron.error.responsibility*connection.gain*connection.weight}this.error.projected=this.derivative*error;error=0;for(var id in this.trace.extended){var neuron=this.neighboors[id];var influence=neuron.selfconnection.gater==this?neuron.old:0;for(var input in this.trace.influences[id]){influence+=this.trace.influences[id][input].weight*this.trace.influences[neuron.ID][input].from.activation}error+=neuron.error.responsibility*influence}this.error.gated=this.derivative*error;this.error.responsibility=this.error.projected+this.error.gated}rate=rate||.1;for(var id in this.connections.inputs){var input=this.connections.inputs[id];var gradient=this.error.projected*this.trace.elegibility[input.ID];for(var id in this.trace.extended){var neuron=this.neighboors[id];gradient+=neuron.error.responsibility*this.trace.extended[neuron.ID][input.ID]}input.weight+=rate*gradient}this.bias+=rate*this.error.responsibility},project:function(neuron,weight){if(neuron==this){this.selfconnection.weight=1;return this.selfconnection}var connected=this.connected(neuron);if(connected&&connected.type=="projected"){if(typeof weight!="undefined")connected.connection.weight=weight;return connected.connection}else{var connection=new Neuron.connection(this,neuron,weight)}this.connections.projected[connection.ID]=connection;this.neighboors[neuron.ID]=neuron;neuron.connections.inputs[connection.ID]=connection;neuron.trace.elegibility[connection.ID]=0;for(var id in neuron.trace.extended){var trace=neuron.trace.extended[id];trace[connection.ID]=0}return connection},gate:function(connection){this.connections.gated[connection.ID]=connection;var neuron=connection.to;if(!(neuron.ID in this.trace.extended)){this.neighboors[neuron.ID]=neuron;var xtrace=this.trace.extended[neuron.ID]={};for(var id in this.connections.inputs){var input=this.connections.inputs[id];xtrace[input.ID]=0}}if(neuron.ID in this.trace.influences)this.trace.influences[neuron.ID].push(connection);else this.trace.influences[neuron.ID]=[connection];connection.gater=this},selfconnected:function(){return this.selfconnection.weight!==0},connected:function(neuron){var result={type:null,connection:false};if(this==neuron){if(this.selfconnected()){result.type="selfconnection";result.connection=this.selfconnection;return result}else return false}for(var type in this.connections){for(var connection in this.connections[type]){var connection=this.connections[type][connection];if(connection.to==neuron){result.type=type;result.connection=connection;return result}else if(connection.from==neuron){result.type=type;result.connection=connection;return result}}}return false},clear:function(){for(var trace in this.trace.elegibility)this.trace.elegibility[trace]=0;for(var trace in this.trace.extended)for(var extended in this.trace.extended[trace])this.trace.extended[trace][extended]=0;this.error.responsibility=this.error.projected=this.error.gated=0},reset:function(){this.clear();for(var type in this.connections)for(var connection in this.connections[type])this.connections[type][connection].weight=Math.random()*.2-.1;this.bias=Math.random()*.2-.1;this.old=this.state=this.activation=0},optimize:function(optimized,layer){optimized=optimized||{};var store_activation=[];var store_trace=[];var store_propagation=[];var varID=optimized.memory||0;var neurons=optimized.neurons||1;var inputs=optimized.inputs||[];var targets=optimized.targets||[];var outputs=optimized.outputs||[];var variables=optimized.variables||{};var activation_sentences=optimized.activation_sentences||[];var trace_sentences=optimized.trace_sentences||[];var propagation_sentences=optimized.propagation_sentences||[];var layers=optimized.layers||{__count:0,__neuron:0};var allocate=function(store){var allocated=layer in layers&&store[layers.__count];if(!allocated){layers.__count=store.push([])-1;layers[layer]=layers.__count}};allocate(activation_sentences);allocate(trace_sentences);allocate(propagation_sentences);var currentLayer=layers.__count;var getVar=function(){var args=Array.prototype.slice.call(arguments);if(args.length==1){if(args[0]=="target"){var id="target_"+targets.length;targets.push(varID)}else var id=args[0];if(id in variables)return variables[id];return variables[id]={value:0,id:varID++}}else{var extended=args.length>2;if(extended)var value=args.pop();var unit=args.shift();var prop=args.pop();if(!extended)var value=unit[prop];var id=prop+"_";for(var property in args)id+=args[property]+"_";id+=unit.ID;if(id in variables)return variables[id];return variables[id]={value:value,id:varID++}}};var buildSentence=function(){var args=Array.prototype.slice.call(arguments);var store=args.pop();var sentence="";for(var i in args)if(typeof args[i]=="string")sentence+=args[i];else sentence+="F["+args[i].id+"]";store.push(sentence+";")};var isEmpty=function(obj){for(var prop in obj){if(obj.hasOwnProperty(prop))return false}return true};var noProjections=isEmpty(this.connections.projected);var noGates=isEmpty(this.connections.gated);var isInput=layer=="input"?true:isEmpty(this.connections.inputs);var isOutput=layer=="output"?true:noProjections&&noGates;var rate=getVar("rate");var activation=getVar(this,"activation");if(isInput)inputs.push(activation.id);else{activation_sentences[currentLayer].push(store_activation);trace_sentences[currentLayer].push(store_trace);propagation_sentences[currentLayer].push(store_propagation);var old=getVar(this,"old");var state=getVar(this,"state");var bias=getVar(this,"bias");if(this.selfconnection.gater)var self_gain=getVar(this.selfconnection,"gain");if(this.selfconnected())var self_weight=getVar(this.selfconnection,"weight");buildSentence(old," = ",state,store_activation);if(this.selfconnected())if(this.selfconnection.gater)buildSentence(state," = ",self_gain," * ",self_weight," * ",state," + ",bias,store_activation);else buildSentence(state," = ",self_weight," * ",state," + ",bias,store_activation);else buildSentence(state," = ",bias,store_activation);for(var i in this.connections.inputs){var input=this.connections.inputs[i];var input_activation=getVar(input.from,"activation");var input_weight=getVar(input,"weight");if(input.gater)var input_gain=getVar(input,"gain");if(this.connections.inputs[i].gater)buildSentence(state," += ",input_activation," * ",input_weight," * ",input_gain,store_activation);else buildSentence(state," += ",input_activation," * ",input_weight,store_activation)}var derivative=getVar(this,"derivative");switch(this.squash){case Neuron.squash.LOGISTIC:buildSentence(activation," = (1 / (1 + Math.exp(-",state,")))",store_activation);buildSentence(derivative," = ",activation," * (1 - ",activation,")",store_activation);break;case Neuron.squash.TANH:var eP=getVar("aux");var eN=getVar("aux_2");buildSentence(eP," = Math.exp(",state,")",store_activation);buildSentence(eN," = 1 / ",eP,store_activation);buildSentence(activation," = (",eP," - ",eN,") / (",eP," + ",eN,")",store_activation);buildSentence(derivative," = 1 - (",activation," * ",activation,")",store_activation);break;case Neuron.squash.IDENTITY:buildSentence(activation," = ",state,store_activation);buildSentence(derivative," = 1",store_activation);break;case Neuron.squash.HLIM:buildSentence(activation," = +(",state," > 0)",store_activation);buildSentence(derivative," = 1",store_activation);case Neuron.squash.RELU:buildSentence(activation," = ",state," > 0 ? ",state," : 0",store_activation);buildSentence(derivative," = ",state," > 0 ? 1 : 0",store_activation);break}for(var id in this.trace.extended){var neuron=this.neighboors[id];var influence=getVar("influences["+neuron.ID+"]");var neuron_old=getVar(neuron,"old");var initialized=false;if(neuron.selfconnection.gater==this){buildSentence(influence," = ",neuron_old,store_trace);initialized=true}for(var incoming in this.trace.influences[neuron.ID]){var incoming_weight=getVar(this.trace.influences[neuron.ID][incoming],"weight");var incoming_activation=getVar(this.trace.influences[neuron.ID][incoming].from,"activation");if(initialized)buildSentence(influence," += ",incoming_weight," * ",incoming_activation,store_trace);else{buildSentence(influence," = ",incoming_weight," * ",incoming_activation,store_trace);initialized=true}}}for(var i in this.connections.inputs){var input=this.connections.inputs[i];if(input.gater)var input_gain=getVar(input,"gain");var input_activation=getVar(input.from,"activation");var trace=getVar(this,"trace","elegibility",input.ID,this.trace.elegibility[input.ID]);if(this.selfconnected()){if(this.selfconnection.gater){if(input.gater)buildSentence(trace," = ",self_gain," * ",self_weight," * ",trace," + ",input_gain," * ",input_activation,store_trace);else buildSentence(trace," = ",self_gain," * ",self_weight," * ",trace," + ",input_activation,store_trace)}else{if(input.gater)buildSentence(trace," = ",self_weight," * ",trace," + ",input_gain," * ",input_activation,store_trace);else buildSentence(trace," = ",self_weight," * ",trace," + ",input_activation,store_trace)}}else{if(input.gater)buildSentence(trace," = ",input_gain," * ",input_activation,store_trace);else buildSentence(trace," = ",input_activation,store_trace)}for(var id in this.trace.extended){var neuron=this.neighboors[id];var influence=getVar("influences["+neuron.ID+"]");var trace=getVar(this,"trace","elegibility",input.ID,this.trace.elegibility[input.ID]);var xtrace=getVar(this,"trace","extended",neuron.ID,input.ID,this.trace.extended[neuron.ID][input.ID]);if(neuron.selfconnected())var neuron_self_weight=getVar(neuron.selfconnection,"weight");if(neuron.selfconnection.gater)var neuron_self_gain=getVar(neuron.selfconnection,"gain");if(neuron.selfconnected())if(neuron.selfconnection.gater)buildSentence(xtrace," = ",neuron_self_gain," * ",neuron_self_weight," * ",xtrace," + ",derivative," * ",trace," * ",influence,store_trace);else buildSentence(xtrace," = ",neuron_self_weight," * ",xtrace," + ",derivative," * ",trace," * ",influence,store_trace);else buildSentence(xtrace," = ",derivative," * ",trace," * ",influence,store_trace)}}for(var connection in this.connections.gated){var gated_gain=getVar(this.connections.gated[connection],"gain");buildSentence(gated_gain," = ",activation,store_activation)}}if(!isInput){var responsibility=getVar(this,"error","responsibility",this.error.responsibility);if(isOutput){var target=getVar("target");buildSentence(responsibility," = ",target," - ",activation,store_propagation);for(var id in this.connections.inputs){var input=this.connections.inputs[id];var trace=getVar(this,"trace","elegibility",input.ID,this.trace.elegibility[input.ID]);var input_weight=getVar(input,"weight");buildSentence(input_weight," += ",rate," * (",responsibility," * ",trace,")",store_propagation)}outputs.push(activation.id)}else{if(!noProjections&&!noGates){var error=getVar("aux");for(var id in this.connections.projected){var connection=this.connections.projected[id];var neuron=connection.to;var connection_weight=getVar(connection,"weight");var neuron_responsibility=getVar(neuron,"error","responsibility",neuron.error.responsibility);if(connection.gater){var connection_gain=getVar(connection,"gain");buildSentence(error," += ",neuron_responsibility," * ",connection_gain," * ",connection_weight,store_propagation)}else buildSentence(error," += ",neuron_responsibility," * ",connection_weight,store_propagation)}var projected=getVar(this,"error","projected",this.error.projected);buildSentence(projected," = ",derivative," * ",error,store_propagation);buildSentence(error," = 0",store_propagation);for(var id in this.trace.extended){var neuron=this.neighboors[id];var influence=getVar("aux_2");var neuron_old=getVar(neuron,"old");if(neuron.selfconnection.gater==this)buildSentence(influence," = ",neuron_old,store_propagation);else buildSentence(influence," = 0",store_propagation);for(var input in this.trace.influences[neuron.ID]){var connection=this.trace.influences[neuron.ID][input];var connection_weight=getVar(connection,"weight");var neuron_activation=getVar(connection.from,"activation");buildSentence(influence," += ",connection_weight," * ",neuron_activation,store_propagation)}var neuron_responsibility=getVar(neuron,"error","responsibility",neuron.error.responsibility);buildSentence(error," += ",neuron_responsibility," * ",influence,store_propagation)}var gated=getVar(this,"error","gated",this.error.gated);buildSentence(gated," = ",derivative," * ",error,store_propagation);buildSentence(responsibility," = ",projected," + ",gated,store_propagation);for(var id in this.connections.inputs){var input=this.connections.inputs[id];var gradient=getVar("aux");var trace=getVar(this,"trace","elegibility",input.ID,this.trace.elegibility[input.ID]);buildSentence(gradient," = ",projected," * ",trace,store_propagation);for(var id in this.trace.extended){var neuron=this.neighboors[id];var neuron_responsibility=getVar(neuron,"error","responsibility",neuron.error.responsibility);var xtrace=getVar(this,"trace","extended",neuron.ID,input.ID,this.trace.extended[neuron.ID][input.ID]);buildSentence(gradient," += ",neuron_responsibility," * ",xtrace,store_propagation)}var input_weight=getVar(input,"weight");buildSentence(input_weight," += ",rate," * ",gradient,store_propagation)}}else if(noGates){buildSentence(responsibility," = 0",store_propagation);for(var id in this.connections.projected){var connection=this.connections.projected[id];var neuron=connection.to;var connection_weight=getVar(connection,"weight");var neuron_responsibility=getVar(neuron,"error","responsibility",neuron.error.responsibility);if(connection.gater){var connection_gain=getVar(connection,"gain");buildSentence(responsibility," += ",neuron_responsibility," * ",connection_gain," * ",connection_weight,store_propagation)}else buildSentence(responsibility," += ",neuron_responsibility," * ",connection_weight,store_propagation)}buildSentence(responsibility," *= ",derivative,store_propagation);for(var id in this.connections.inputs){var input=this.connections.inputs[id];var trace=getVar(this,"trace","elegibility",input.ID,this.trace.elegibility[input.ID]);var input_weight=getVar(input,"weight");buildSentence(input_weight," += ",rate," * (",responsibility," * ",trace,")",store_propagation)}}else if(noProjections){buildSentence(responsibility," = 0",store_propagation);for(var id in this.trace.extended){var neuron=this.neighboors[id];var influence=getVar("aux");var neuron_old=getVar(neuron,"old");if(neuron.selfconnection.gater==this)buildSentence(influence," = ",neuron_old,store_propagation);else buildSentence(influence," = 0",store_propagation);for(var input in this.trace.influences[neuron.ID]){var connection=this.trace.influences[neuron.ID][input];var connection_weight=getVar(connection,"weight");var neuron_activation=getVar(connection.from,"activation");buildSentence(influence," += ",connection_weight," * ",neuron_activation,store_propagation)}var neuron_responsibility=getVar(neuron,"error","responsibility",neuron.error.responsibility);buildSentence(responsibility," += ",neuron_responsibility," * ",influence,store_propagation)}buildSentence(responsibility," *= ",derivative,store_propagation);for(var id in this.connections.inputs){var input=this.connections.inputs[id];var gradient=getVar("aux");buildSentence(gradient," = 0",store_propagation);for(var id in this.trace.extended){var neuron=this.neighboors[id];var neuron_responsibility=getVar(neuron,"error","responsibility",neuron.error.responsibility);var xtrace=getVar(this,"trace","extended",neuron.ID,input.ID,this.trace.extended[neuron.ID][input.ID]);buildSentence(gradient," += ",neuron_responsibility," * ",xtrace,store_propagation)}var input_weight=getVar(input,"weight");buildSentence(input_weight," += ",rate," * ",gradient,store_propagation)}}}buildSentence(bias," += ",rate," * ",responsibility,store_propagation)}return{memory:varID,neurons:neurons+1,inputs:inputs,outputs:outputs,targets:targets,variables:variables,activation_sentences:activation_sentences,trace_sentences:trace_sentences,propagation_sentences:propagation_sentences,layers:layers}}};Neuron.connection=function Connection(from,to,weight){if(!from||!to)throw new Error("Connection Error: Invalid neurons");this.ID=Neuron.connection.uid();this.from=from;this.to=to;this.weight=typeof weight=="undefined"?Math.random()*.2-.1:weight;this.gain=1;this.gater=null};Neuron.squash={};Neuron.squash.LOGISTIC=function(x,derivate){if(!derivate)return 1/(1+Math.exp(-x));var fx=Neuron.squash.LOGISTIC(x);return fx*(1-fx)};Neuron.squash.TANH=function(x,derivate){if(derivate)return 1-Math.pow(Neuron.squash.TANH(x),2);var eP=Math.exp(x);var eN=1/eP;return(eP-eN)/(eP+eN)};Neuron.squash.IDENTITY=function(x,derivate){return derivate?1:x};Neuron.squash.HLIM=function(x,derivate){return derivate?1:x>0?1:0};Neuron.squash.RELU=function(x,derivate){if(derivate)return x>0?1:0;return x>0?x:0};(function(){var neurons=0;var connections=0;Neuron.uid=function(){return neurons++};Neuron.connection.uid=function(){return connections++};Neuron.quantity=function(){return{neurons:neurons,connections:connections}}})()},{}],42:[function(require,module,exports){if(module)module.exports=Trainer;function Trainer(network,options){options=options||{};this.network=network;this.rate=options.rate||.2;this.iterations=options.iterations||1e5;this.error=options.error||.005;this.cost=options.cost||null;this.crossValidate=options.crossValidate||null}Trainer.prototype={train:function(set,options){var error=1;var iterations=bucketSize=0;var abort=false;var currentRate;var cost=options&&options.cost||this.cost||Trainer.cost.MSE;var crossValidate=false,testSet,trainSet;var start=Date.now();if(options){if(options.shuffle){function shuffle(o){for(var j,x,i=o.length;i;j=Math.floor(Math.random()*i),x=o[--i],o[i]=o[j],o[j]=x);return o}}if(options.iterations)this.iterations=options.iterations;if(options.error)this.error=options.error;if(options.rate)this.rate=options.rate;if(options.cost)this.cost=options.cost;if(options.schedule)this.schedule=options.schedule;if(options.customLog){console.log("Deprecated: use schedule instead of customLog");this.schedule=options.customLog}if(this.crossValidate||options.crossValidate){if(!this.crossValidate)this.crossValidate={};crossValidate=true;if(options.crossValidate.testSize)this.crossValidate.testSize=options.crossValidate.testSize;if(options.crossValidate.testError)this.crossValidate.testError=options.crossValidate.testError}}currentRate=this.rate;if(Array.isArray(this.rate)){var bucketSize=Math.floor(this.iterations/this.rate.length)}if(crossValidate){var numTrain=Math.ceil((1-this.crossValidate.testSize)*set.length);trainSet=set.slice(0,numTrain);testSet=set.slice(numTrain)}while(!abort&&iterations<this.iterations&&error>this.error){if(crossValidate&&error<=this.crossValidate.testError){break}var currentSetSize=set.length;error=0;iterations++;if(bucketSize>0){var currentBucket=Math.floor(iterations/bucketSize);currentRate=this.rate[currentBucket]||currentRate}if(typeof this.rate==="function"){currentRate=this.rate(iterations,error)}if(crossValidate){this._trainSet(trainSet,currentRate,cost);error+=this.test(testSet).error;currentSetSize=1}else{error+=this._trainSet(set,currentRate,cost);currentSetSize=set.length}error/=currentSetSize;if(options){if(this.schedule&&this.schedule.every&&iterations%this.schedule.every==0)abort=this.schedule.do({error:error,iterations:iterations,rate:currentRate});else if(options.log&&iterations%options.log==0){console.log("iterations",iterations,"error",error,"rate",currentRate)}if(options.shuffle)shuffle(set)}}var results={error:error,iterations:iterations,time:Date.now()-start};return results},trainAsync:function(set,options){var train=this.workerTrain.bind(this);return new Promise(function(resolve,reject){try{train(set,resolve,options,true)}catch(e){reject(e)}})},_trainSet:function(set,currentRate,costFunction){var errorSum=0;for(var train in set){var input=set[train].input;var target=set[train].output;var output=this.network.activate(input);this.network.propagate(currentRate,target);errorSum+=costFunction(target,output)}return errorSum},test:function(set,options){var error=0;var input,output,target;var cost=options&&options.cost||this.cost||Trainer.cost.MSE;var start=Date.now();for(var test in set){input=set[test].input;target=set[test].output;output=this.network.activate(input);error+=cost(target,output)}error/=set.length;var results={error:error,time:Date.now()-start};return results},workerTrain:function(set,callback,options,suppressWarning){if(!suppressWarning){console.warn("Deprecated: do not use `workerTrain`, use `trainAsync` instead.")}var that=this;if(!this.network.optimized)this.network.optimize();var worker=this.network.worker(this.network.optimized.memory,set,options);worker.onmessage=function(e){switch(e.data.action){case"done":var iterations=e.data.message.iterations;var error=e.data.message.error;var time=e.data.message.time;that.network.optimized.ownership(e.data.memoryBuffer);callback({error:error,iterations:iterations,time:time});worker.terminate();break;case"log":console.log(e.data.message);case"schedule":if(options&&options.schedule&&typeof options.schedule.do==="function"){var scheduled=options.schedule.do;scheduled(e.data.message)}break}};worker.postMessage({action:"startTraining"})},XOR:function(options){if(this.network.inputs()!=2||this.network.outputs()!=1)throw new Error("Incompatible network (2 inputs, 1 output)");var defaults={iterations:1e5,log:false,shuffle:true,cost:Trainer.cost.MSE};if(options)for(var i in options)defaults[i]=options[i];return this.train([{input:[0,0],output:[0]},{input:[1,0],output:[1]},{input:[0,1],output:[1]},{input:[1,1],output:[0]}],defaults)},DSR:function(options){options=options||{};var targets=options.targets||[2,4,7,8];var distractors=options.distractors||[3,5,6,9];var prompts=options.prompts||[0,1];var length=options.length||24;var criterion=options.success||.95;var iterations=options.iterations||1e5;var rate=options.rate||.1;var log=options.log||0;var schedule=options.schedule||{};var cost=options.cost||this.cost||Trainer.cost.CROSS_ENTROPY;var trial,correct,i,j,success;trial=correct=i=j=success=0;var error=1,symbols=targets.length+distractors.length+prompts.length;var noRepeat=function(range,avoid){var number=Math.random()*range|0;var used=false;for(var i in avoid)if(number==avoid[i])used=true;return used?noRepeat(range,avoid):number};var equal=function(prediction,output){for(var i in prediction)if(Math.round(prediction[i])!=output[i])return false;return true};var start=Date.now();while(trial<iterations&&(success<criterion||trial%1e3!=0)){var sequence=[],sequenceLength=length-prompts.length;for(i=0;i<sequenceLength;i++){var any=Math.random()*distractors.length|0;sequence.push(distractors[any])}var indexes=[],positions=[];for(i=0;i<prompts.length;i++){indexes.push(Math.random()*targets.length|0);positions.push(noRepeat(sequenceLength,positions))}positions=positions.sort();for(i=0;i<prompts.length;i++){sequence[positions[i]]=targets[indexes[i]];sequence.push(prompts[i])}var distractorsCorrect;var targetsCorrect=distractorsCorrect=0;error=0;for(i=0;i<length;i++){var input=[];for(j=0;j<symbols;j++)input[j]=0;input[sequence[i]]=1;var output=[];for(j=0;j<targets.length;j++)output[j]=0;if(i>=sequenceLength){var index=i-sequenceLength;output[indexes[index]]=1}var prediction=this.network.activate(input);if(equal(prediction,output))if(i<sequenceLength)distractorsCorrect++;else targetsCorrect++;else{this.network.propagate(rate,output)}error+=cost(output,prediction);if(distractorsCorrect+targetsCorrect==length)correct++}if(trial%1e3==0)correct=0;trial++;var divideError=trial%1e3;divideError=divideError==0?1e3:divideError;success=correct/divideError;error/=length;if(log&&trial%log==0)console.log("iterations:",trial," success:",success," correct:",correct," time:",Date.now()-start," error:",error);if(schedule.do&&schedule.every&&trial%schedule.every==0)schedule.do({iterations:trial,success:success,error:error,time:Date.now()-start,correct:correct})}return{iterations:trial,success:success,error:error,time:Date.now()-start}},ERG:function(options){options=options||{};var iterations=options.iterations||15e4;var criterion=options.error||.05;var rate=options.rate||.1;var log=options.log||500;var cost=options.cost||this.cost||Trainer.cost.CROSS_ENTROPY;var Node=function(){this.paths=[]};Node.prototype={connect:function(node,value){this.paths.push({node:node,value:value});return this},any:function(){if(this.paths.length==0)return false;var index=Math.random()*this.paths.length|0;return this.paths[index]},test:function(value){for(var i in this.paths)if(this.paths[i].value==value)return this.paths[i];return false}};var reberGrammar=function(){var output=new Node;var n1=(new Node).connect(output,"E");var n2=(new Node).connect(n1,"S");var n3=(new Node).connect(n1,"V").connect(n2,"P");var n4=(new Node).connect(n2,"X");n4.connect(n4,"S");var n5=(new Node).connect(n3,"V");n5.connect(n5,"T");n2.connect(n5,"X");var n6=(new Node).connect(n4,"T").connect(n5,"P");var input=(new Node).connect(n6,"B");return{input:input,output:output}};var embededReberGrammar=function(){var reber1=reberGrammar();var reber2=reberGrammar();var output=new Node;var n1=(new Node).connect(output,"E");reber1.output.connect(n1,"T");reber2.output.connect(n1,"P");var n2=(new Node).connect(reber1.input,"P").connect(reber2.input,"T");var input=(new Node).connect(n2,"B");return{input:input,output:output}};var generate=function(){var node=embededReberGrammar().input;var next=node.any();var str="";while(next){str+=next.value;next=next.node.any()}return str};var test=function(str){var node=embededReberGrammar().input;var i=0;var ch=str.charAt(i);while(i<str.length){var next=node.test(ch);if(!next)return false;node=next.node;ch=str.charAt(++i)}return true};var different=function(array1,array2){var max1=0;var i1=-1;var max2=0;var i2=-1;for(var i in array1){if(array1[i]>max1){max1=array1[i];i1=i}if(array2[i]>max2){max2=array2[i];i2=i}}return i1!=i2};var iteration=0;var error=1;var table={B:0,P:1,T:2,X:3,S:4,E:5};var start=Date.now();while(iteration<iterations&&error>criterion){var i=0;error=0;var sequence=generate();var read=sequence.charAt(i);var predict=sequence.charAt(i+1);while(i<sequence.length-1){var input=[];var target=[];for(var j=0;j<6;j++){input[j]=0;target[j]=0}input[table[read]]=1;target[table[predict]]=1;var output=this.network.activate(input);if(different(output,target))this.network.propagate(rate,target);read=sequence.charAt(++i);predict=sequence.charAt(i+1);error+=cost(target,output)}error/=sequence.length;iteration++;if(iteration%log==0){console.log("iterations:",iteration," time:",Date.now()-start," error:",error)}}return{iterations:iteration,error:error,time:Date.now()-start,test:test,generate:generate}},timingTask:function(options){if(this.network.inputs()!=2||this.network.outputs()!=1)throw new Error("Invalid Network: must have 2 inputs and one output");if(typeof options=="undefined")options={};function getSamples(trainingSize,testSize){var size=trainingSize+testSize;var t=0;var set=[];for(var i=0;i<size;i++){set.push({input:[0,0],output:[0]})}while(t<size-20){var n=Math.round(Math.random()*20);set[t].input[0]=1;for(var j=t;j<=t+n;j++){set[j].input[1]=n/20;set[j].output[0]=.5}t+=n;n=Math.round(Math.random()*20);for(var k=t+1;k<=t+n&&k<size;k++)set[k].input[1]=set[t].input[1];t+=n}var trainingSet=[];var testSet=[];for(var l=0;l<size;l++)(l<trainingSize?trainingSet:testSet).push(set[l]);return{train:trainingSet,test:testSet}}var iterations=options.iterations||200;var error=options.error||.005;var rate=options.rate||[.03,.02];var log=options.log===false?false:options.log||10;var cost=options.cost||this.cost||Trainer.cost.MSE;var trainingSamples=options.trainSamples||7e3;var testSamples=options.trainSamples||1e3;var samples=getSamples(trainingSamples,testSamples);var result=this.train(samples.train,{rate:rate,log:log,iterations:iterations,error:error,cost:cost});return{train:result,test:this.test(samples.test)}}};Trainer.cost={CROSS_ENTROPY:function(target,output){var crossentropy=0;for(var i in output)crossentropy-=target[i]*Math.log(output[i]+1e-15)+(1-target[i])*Math.log(1+1e-15-output[i]);return crossentropy},MSE:function(target,output){var mse=0;for(var i in output)mse+=Math.pow(target[i]-output[i],2);return mse/output.length},BINARY:function(target,output){var misses=0;for(var i in output)misses+=Math.round(target[i]*2)!=Math.round(output[i]*2);return misses}}},{}],43:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;
switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}],"brain.js":[function(require,module,exports){exports.NeuralNetwork=require("./neuralnetwork").NeuralNetwork;exports.crossValidate=require("./cross-validate")},{"./cross-validate":27,"./neuralnetwork":29}],convnetjs:[function(require,module,exports){var convnetjs=convnetjs||{REVISION:"ALPHA"};(function(global){"use strict";var return_v=false;var v_val=0;var gaussRandom=function(){if(return_v){return_v=false;return v_val}var u=2*Math.random()-1;var v=2*Math.random()-1;var r=u*u+v*v;if(r==0||r>1)return gaussRandom();var c=Math.sqrt(-2*Math.log(r)/r);v_val=v*c;return_v=true;return u*c};var randf=function(a,b){return Math.random()*(b-a)+a};var randi=function(a,b){return Math.floor(Math.random()*(b-a)+a)};var randn=function(mu,std){return mu+gaussRandom()*std};var zeros=function(n){if(typeof n==="undefined"||isNaN(n)){return[]}if(typeof ArrayBuffer==="undefined"){var arr=new Array(n);for(var i=0;i<n;i++){arr[i]=0}return arr}else{return new Float64Array(n)}};var arrContains=function(arr,elt){for(var i=0,n=arr.length;i<n;i++){if(arr[i]===elt)return true}return false};var arrUnique=function(arr){var b=[];for(var i=0,n=arr.length;i<n;i++){if(!arrContains(b,arr[i])){b.push(arr[i])}}return b};var maxmin=function(w){if(w.length===0){return{}}var maxv=w[0];var minv=w[0];var maxi=0;var mini=0;var n=w.length;for(var i=1;i<n;i++){if(w[i]>maxv){maxv=w[i];maxi=i}if(w[i]<minv){minv=w[i];mini=i}}return{maxi:maxi,maxv:maxv,mini:mini,minv:minv,dv:maxv-minv}};var randperm=function(n){var i=n,j=0,temp;var array=[];for(var q=0;q<n;q++)array[q]=q;while(i--){j=Math.floor(Math.random()*(i+1));temp=array[i];array[i]=array[j];array[j]=temp}return array};var weightedSample=function(lst,probs){var p=randf(0,1);var cumprob=0;for(var k=0,n=lst.length;k<n;k++){cumprob+=probs[k];if(p<cumprob){return lst[k]}}};var getopt=function(opt,field_name,default_value){return typeof opt[field_name]!=="undefined"?opt[field_name]:default_value};global.randf=randf;global.randi=randi;global.randn=randn;global.zeros=zeros;global.maxmin=maxmin;global.randperm=randperm;global.weightedSample=weightedSample;global.arrUnique=arrUnique;global.arrContains=arrContains;global.getopt=getopt})(convnetjs);(function(global){"use strict";var Vol=function(sx,sy,depth,c){if(Object.prototype.toString.call(sx)==="[object Array]"){this.sx=1;this.sy=1;this.depth=sx.length;this.w=global.zeros(this.depth);this.dw=global.zeros(this.depth);for(var i=0;i<this.depth;i++){this.w[i]=sx[i]}}else{this.sx=sx;this.sy=sy;this.depth=depth;var n=sx*sy*depth;this.w=global.zeros(n);this.dw=global.zeros(n);if(typeof c==="undefined"){var scale=Math.sqrt(1/(sx*sy*depth));for(var i=0;i<n;i++){this.w[i]=global.randn(0,scale)}}else{for(var i=0;i<n;i++){this.w[i]=c}}}};Vol.prototype={get:function(x,y,d){var ix=(this.sx*y+x)*this.depth+d;return this.w[ix]},set:function(x,y,d,v){var ix=(this.sx*y+x)*this.depth+d;this.w[ix]=v},add:function(x,y,d,v){var ix=(this.sx*y+x)*this.depth+d;this.w[ix]+=v},get_grad:function(x,y,d){var ix=(this.sx*y+x)*this.depth+d;return this.dw[ix]},set_grad:function(x,y,d,v){var ix=(this.sx*y+x)*this.depth+d;this.dw[ix]=v},add_grad:function(x,y,d,v){var ix=(this.sx*y+x)*this.depth+d;this.dw[ix]+=v},cloneAndZero:function(){return new Vol(this.sx,this.sy,this.depth,0)},clone:function(){var V=new Vol(this.sx,this.sy,this.depth,0);var n=this.w.length;for(var i=0;i<n;i++){V.w[i]=this.w[i]}return V},addFrom:function(V){for(var k=0;k<this.w.length;k++){this.w[k]+=V.w[k]}},addFromScaled:function(V,a){for(var k=0;k<this.w.length;k++){this.w[k]+=a*V.w[k]}},setConst:function(a){for(var k=0;k<this.w.length;k++){this.w[k]=a}},toJSON:function(){var json={};json.sx=this.sx;json.sy=this.sy;json.depth=this.depth;json.w=this.w;return json},fromJSON:function(json){this.sx=json.sx;this.sy=json.sy;this.depth=json.depth;var n=this.sx*this.sy*this.depth;this.w=global.zeros(n);this.dw=global.zeros(n);for(var i=0;i<n;i++){this.w[i]=json.w[i]}}};global.Vol=Vol})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var augment=function(V,crop,dx,dy,fliplr){if(typeof fliplr==="undefined")var fliplr=false;if(typeof dx==="undefined")var dx=global.randi(0,V.sx-crop);if(typeof dy==="undefined")var dy=global.randi(0,V.sy-crop);var W;if(crop!==V.sx||dx!==0||dy!==0){W=new Vol(crop,crop,V.depth,0);for(var x=0;x<crop;x++){for(var y=0;y<crop;y++){if(x+dx<0||x+dx>=V.sx||y+dy<0||y+dy>=V.sy)continue;for(var d=0;d<V.depth;d++){W.set(x,y,d,V.get(x+dx,y+dy,d))}}}}else{W=V}if(fliplr){var W2=W.cloneAndZero();for(var x=0;x<W.sx;x++){for(var y=0;y<W.sy;y++){for(var d=0;d<W.depth;d++){W2.set(x,y,d,W.get(W.sx-x-1,y,d))}}}W=W2}return W};var img_to_vol=function(img,convert_grayscale){if(typeof convert_grayscale==="undefined")var convert_grayscale=false;var canvas=document.createElement("canvas");canvas.width=img.width;canvas.height=img.height;var ctx=canvas.getContext("2d");try{ctx.drawImage(img,0,0)}catch(e){if(e.name==="NS_ERROR_NOT_AVAILABLE"){return false}else{throw e}}try{var img_data=ctx.getImageData(0,0,canvas.width,canvas.height)}catch(e){if(e.name==="IndexSizeError"){return false}else{throw e}}var p=img_data.data;var W=img.width;var H=img.height;var pv=[];for(var i=0;i<p.length;i++){pv.push(p[i]/255-.5)}var x=new Vol(W,H,4,0);x.w=pv;if(convert_grayscale){var x1=new Vol(W,H,1,0);for(var i=0;i<W;i++){for(var j=0;j<H;j++){x1.set(i,j,0,x.get(i,j,0))}}x=x1}return x};global.augment=augment;global.img_to_vol=img_to_vol})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var ConvLayer=function(opt){var opt=opt||{};this.out_depth=opt.filters;this.sx=opt.sx;this.in_depth=opt.in_depth;this.in_sx=opt.in_sx;this.in_sy=opt.in_sy;this.sy=typeof opt.sy!=="undefined"?opt.sy:this.sx;this.stride=typeof opt.stride!=="undefined"?opt.stride:1;this.pad=typeof opt.pad!=="undefined"?opt.pad:0;this.l1_decay_mul=typeof opt.l1_decay_mul!=="undefined"?opt.l1_decay_mul:0;this.l2_decay_mul=typeof opt.l2_decay_mul!=="undefined"?opt.l2_decay_mul:1;this.out_sx=Math.floor((this.in_sx+this.pad*2-this.sx)/this.stride+1);this.out_sy=Math.floor((this.in_sy+this.pad*2-this.sy)/this.stride+1);this.layer_type="conv";var bias=typeof opt.bias_pref!=="undefined"?opt.bias_pref:0;this.filters=[];for(var i=0;i<this.out_depth;i++){this.filters.push(new Vol(this.sx,this.sy,this.in_depth))}this.biases=new Vol(1,1,this.out_depth,bias)};ConvLayer.prototype={forward:function(V,is_training){this.in_act=V;var A=new Vol(this.out_sx,this.out_sy,this.out_depth,0);for(var d=0;d<this.out_depth;d++){var f=this.filters[d];var x=-this.pad;var y=-this.pad;for(var ax=0;ax<this.out_sx;x+=this.stride,ax++){y=-this.pad;for(var ay=0;ay<this.out_sy;y+=this.stride,ay++){var a=0;for(var fx=0;fx<f.sx;fx++){for(var fy=0;fy<f.sy;fy++){for(var fd=0;fd<f.depth;fd++){var oy=y+fy;var ox=x+fx;if(oy>=0&&oy<V.sy&&ox>=0&&ox<V.sx){a+=f.w[(f.sx*fy+fx)*f.depth+fd]*V.w[(V.sx*oy+ox)*V.depth+fd]}}}}a+=this.biases.w[d];A.set(ax,ay,d,a)}}}this.out_act=A;return this.out_act},backward:function(){var V=this.in_act;V.dw=global.zeros(V.w.length);for(var d=0;d<this.out_depth;d++){var f=this.filters[d];var x=-this.pad;var y=-this.pad;for(var ax=0;ax<this.out_sx;x+=this.stride,ax++){y=-this.pad;for(var ay=0;ay<this.out_sy;y+=this.stride,ay++){var chain_grad=this.out_act.get_grad(ax,ay,d);for(var fx=0;fx<f.sx;fx++){for(var fy=0;fy<f.sy;fy++){for(var fd=0;fd<f.depth;fd++){var oy=y+fy;var ox=x+fx;if(oy>=0&&oy<V.sy&&ox>=0&&ox<V.sx){
var ix1=(V.sx*oy+ox)*V.depth+fd;var ix2=(f.sx*fy+fx)*f.depth+fd;f.dw[ix2]+=V.w[ix1]*chain_grad;V.dw[ix1]+=f.w[ix2]*chain_grad}}}}this.biases.dw[d]+=chain_grad}}}},getParamsAndGrads:function(){var response=[];for(var i=0;i<this.out_depth;i++){response.push({params:this.filters[i].w,grads:this.filters[i].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul})}response.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0});return response},toJSON:function(){var json={};json.sx=this.sx;json.sy=this.sy;json.stride=this.stride;json.in_depth=this.in_depth;json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;json.l1_decay_mul=this.l1_decay_mul;json.l2_decay_mul=this.l2_decay_mul;json.pad=this.pad;json.filters=[];for(var i=0;i<this.filters.length;i++){json.filters.push(this.filters[i].toJSON())}json.biases=this.biases.toJSON();return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type;this.sx=json.sx;this.sy=json.sy;this.stride=json.stride;this.in_depth=json.in_depth;this.filters=[];this.l1_decay_mul=typeof json.l1_decay_mul!=="undefined"?json.l1_decay_mul:1;this.l2_decay_mul=typeof json.l2_decay_mul!=="undefined"?json.l2_decay_mul:1;this.pad=typeof json.pad!=="undefined"?json.pad:0;for(var i=0;i<json.filters.length;i++){var v=new Vol(0,0,0,0);v.fromJSON(json.filters[i]);this.filters.push(v)}this.biases=new Vol(0,0,0,0);this.biases.fromJSON(json.biases)}};var FullyConnLayer=function(opt){var opt=opt||{};this.out_depth=typeof opt.num_neurons!=="undefined"?opt.num_neurons:opt.filters;this.l1_decay_mul=typeof opt.l1_decay_mul!=="undefined"?opt.l1_decay_mul:0;this.l2_decay_mul=typeof opt.l2_decay_mul!=="undefined"?opt.l2_decay_mul:1;this.num_inputs=opt.in_sx*opt.in_sy*opt.in_depth;this.out_sx=1;this.out_sy=1;this.layer_type="fc";var bias=typeof opt.bias_pref!=="undefined"?opt.bias_pref:0;this.filters=[];for(var i=0;i<this.out_depth;i++){this.filters.push(new Vol(1,1,this.num_inputs))}this.biases=new Vol(1,1,this.out_depth,bias)};FullyConnLayer.prototype={forward:function(V,is_training){this.in_act=V;var A=new Vol(1,1,this.out_depth,0);var Vw=V.w;for(var i=0;i<this.out_depth;i++){var a=0;var wi=this.filters[i].w;for(var d=0;d<this.num_inputs;d++){a+=Vw[d]*wi[d]}a+=this.biases.w[i];A.w[i]=a}this.out_act=A;return this.out_act},backward:function(){var V=this.in_act;V.dw=global.zeros(V.w.length);for(var i=0;i<this.out_depth;i++){var tfi=this.filters[i];var chain_grad=this.out_act.dw[i];for(var d=0;d<this.num_inputs;d++){V.dw[d]+=tfi.w[d]*chain_grad;tfi.dw[d]+=V.w[d]*chain_grad}this.biases.dw[i]+=chain_grad}},getParamsAndGrads:function(){var response=[];for(var i=0;i<this.out_depth;i++){response.push({params:this.filters[i].w,grads:this.filters[i].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul})}response.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0});return response},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;json.num_inputs=this.num_inputs;json.l1_decay_mul=this.l1_decay_mul;json.l2_decay_mul=this.l2_decay_mul;json.filters=[];for(var i=0;i<this.filters.length;i++){json.filters.push(this.filters[i].toJSON())}json.biases=this.biases.toJSON();return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type;this.num_inputs=json.num_inputs;this.l1_decay_mul=typeof json.l1_decay_mul!=="undefined"?json.l1_decay_mul:1;this.l2_decay_mul=typeof json.l2_decay_mul!=="undefined"?json.l2_decay_mul:1;this.filters=[];for(var i=0;i<json.filters.length;i++){var v=new Vol(0,0,0,0);v.fromJSON(json.filters[i]);this.filters.push(v)}this.biases=new Vol(0,0,0,0);this.biases.fromJSON(json.biases)}};global.ConvLayer=ConvLayer;global.FullyConnLayer=FullyConnLayer})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var PoolLayer=function(opt){var opt=opt||{};this.sx=opt.sx;this.in_depth=opt.in_depth;this.in_sx=opt.in_sx;this.in_sy=opt.in_sy;this.sy=typeof opt.sy!=="undefined"?opt.sy:this.sx;this.stride=typeof opt.stride!=="undefined"?opt.stride:2;this.pad=typeof opt.pad!=="undefined"?opt.pad:0;this.out_depth=this.in_depth;this.out_sx=Math.floor((this.in_sx+this.pad*2-this.sx)/this.stride+1);this.out_sy=Math.floor((this.in_sy+this.pad*2-this.sy)/this.stride+1);this.layer_type="pool";this.switchx=global.zeros(this.out_sx*this.out_sy*this.out_depth);this.switchy=global.zeros(this.out_sx*this.out_sy*this.out_depth)};PoolLayer.prototype={forward:function(V,is_training){this.in_act=V;var A=new Vol(this.out_sx,this.out_sy,this.out_depth,0);var n=0;for(var d=0;d<this.out_depth;d++){var x=-this.pad;var y=-this.pad;for(var ax=0;ax<this.out_sx;x+=this.stride,ax++){y=-this.pad;for(var ay=0;ay<this.out_sy;y+=this.stride,ay++){var a=-99999;var winx=-1,winy=-1;for(var fx=0;fx<this.sx;fx++){for(var fy=0;fy<this.sy;fy++){var oy=y+fy;var ox=x+fx;if(oy>=0&&oy<V.sy&&ox>=0&&ox<V.sx){var v=V.get(ox,oy,d);if(v>a){a=v;winx=ox;winy=oy}}}}this.switchx[n]=winx;this.switchy[n]=winy;n++;A.set(ax,ay,d,a)}}}this.out_act=A;return this.out_act},backward:function(){var V=this.in_act;V.dw=global.zeros(V.w.length);var A=this.out_act;var n=0;for(var d=0;d<this.out_depth;d++){var x=-this.pad;var y=-this.pad;for(var ax=0;ax<this.out_sx;x+=this.stride,ax++){y=-this.pad;for(var ay=0;ay<this.out_sy;y+=this.stride,ay++){var chain_grad=this.out_act.get_grad(ax,ay,d);V.add_grad(this.switchx[n],this.switchy[n],d,chain_grad);n++}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.sx=this.sx;json.sy=this.sy;json.stride=this.stride;json.in_depth=this.in_depth;json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;json.pad=this.pad;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type;this.sx=json.sx;this.sy=json.sy;this.stride=json.stride;this.in_depth=json.in_depth;this.pad=typeof json.pad!=="undefined"?json.pad:0;this.switchx=global.zeros(this.out_sx*this.out_sy*this.out_depth);this.switchy=global.zeros(this.out_sx*this.out_sy*this.out_depth)}};global.PoolLayer=PoolLayer})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var InputLayer=function(opt){var opt=opt||{};this.out_sx=typeof opt.out_sx!=="undefined"?opt.out_sx:opt.in_sx;this.out_sy=typeof opt.out_sy!=="undefined"?opt.out_sy:opt.in_sy;this.out_depth=typeof opt.out_depth!=="undefined"?opt.out_depth:opt.in_depth;this.layer_type="input"};InputLayer.prototype={forward:function(V,is_training){this.in_act=V;this.out_act=V;return this.out_act},backward:function(){},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type}};global.InputLayer=InputLayer})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var SoftmaxLayer=function(opt){var opt=opt||{};this.num_inputs=opt.in_sx*opt.in_sy*opt.in_depth;this.out_depth=this.num_inputs;this.out_sx=1;this.out_sy=1;this.layer_type="softmax"};SoftmaxLayer.prototype={forward:function(V,is_training){this.in_act=V;var A=new Vol(1,1,this.out_depth,0);var as=V.w;var amax=V.w[0];for(var i=1;i<this.out_depth;i++){if(as[i]>amax)amax=as[i]}var es=global.zeros(this.out_depth);var esum=0;for(var i=0;i<this.out_depth;i++){var e=Math.exp(as[i]-amax);esum+=e;es[i]=e}for(var i=0;i<this.out_depth;i++){es[i]/=esum;A.w[i]=es[i]}this.es=es;this.out_act=A;return this.out_act},backward:function(y){var x=this.in_act;x.dw=global.zeros(x.w.length);for(var i=0;i<this.out_depth;i++){var indicator=i===y?1:0;var mul=-(indicator-this.es[i]);x.dw[i]=mul}return-Math.log(this.es[y])},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;json.num_inputs=this.num_inputs;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type;this.num_inputs=json.num_inputs}};var RegressionLayer=function(opt){var opt=opt||{};this.num_inputs=opt.in_sx*opt.in_sy*opt.in_depth;this.out_depth=this.num_inputs;this.out_sx=1;this.out_sy=1;this.layer_type="regression"};RegressionLayer.prototype={forward:function(V,is_training){this.in_act=V;this.out_act=V;return V},backward:function(y){var x=this.in_act;x.dw=global.zeros(x.w.length);var loss=0;if(y instanceof Array||y instanceof Float64Array){for(var i=0;i<this.out_depth;i++){var dy=x.w[i]-y[i];x.dw[i]=dy;loss+=2*dy*dy}}else{var i=y.dim;var yi=y.val;var dy=x.w[i]-yi;x.dw[i]=dy;loss+=2*dy*dy}return loss},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;json.num_inputs=this.num_inputs;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type;this.num_inputs=json.num_inputs}};var SVMLayer=function(opt){var opt=opt||{};this.num_inputs=opt.in_sx*opt.in_sy*opt.in_depth;this.out_depth=this.num_inputs;this.out_sx=1;this.out_sy=1;this.layer_type="svm"};SVMLayer.prototype={forward:function(V,is_training){this.in_act=V;this.out_act=V;return V},backward:function(y){var x=this.in_act;x.dw=global.zeros(x.w.length);var yscore=x.w[y];var margin=1;var loss=0;for(var i=0;i<this.out_depth;i++){if(-yscore+x.w[i]+margin>0){x.dw[i]+=1;x.dw[y]-=1;loss+=-yscore+x.w[i]+margin}}return loss},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;json.num_inputs=this.num_inputs;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type;this.num_inputs=json.num_inputs}};global.RegressionLayer=RegressionLayer;global.SoftmaxLayer=SoftmaxLayer;global.SVMLayer=SVMLayer})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var ReluLayer=function(opt){var opt=opt||{};this.out_sx=opt.in_sx;this.out_sy=opt.in_sy;this.out_depth=opt.in_depth;this.layer_type="relu"};ReluLayer.prototype={forward:function(V,is_training){this.in_act=V;var V2=V.clone();var N=V.w.length;var V2w=V2.w;for(var i=0;i<N;i++){if(V2w[i]<0)V2w[i]=0}this.out_act=V2;return this.out_act},backward:function(){var V=this.in_act;var V2=this.out_act;var N=V.w.length;V.dw=global.zeros(N);for(var i=0;i<N;i++){if(V2.w[i]<=0)V.dw[i]=0;else V.dw[i]=V2.dw[i]}},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type}};var SigmoidLayer=function(opt){var opt=opt||{};this.out_sx=opt.in_sx;this.out_sy=opt.in_sy;this.out_depth=opt.in_depth;this.layer_type="sigmoid"};SigmoidLayer.prototype={forward:function(V,is_training){this.in_act=V;var V2=V.cloneAndZero();var N=V.w.length;var V2w=V2.w;var Vw=V.w;for(var i=0;i<N;i++){V2w[i]=1/(1+Math.exp(-Vw[i]))}this.out_act=V2;return this.out_act},backward:function(){var V=this.in_act;var V2=this.out_act;var N=V.w.length;V.dw=global.zeros(N);for(var i=0;i<N;i++){var v2wi=V2.w[i];V.dw[i]=v2wi*(1-v2wi)*V2.dw[i]}},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type}};var MaxoutLayer=function(opt){var opt=opt||{};this.group_size=typeof opt.group_size!=="undefined"?opt.group_size:2;this.out_sx=opt.in_sx;this.out_sy=opt.in_sy;this.out_depth=Math.floor(opt.in_depth/this.group_size);this.layer_type="maxout";this.switches=global.zeros(this.out_sx*this.out_sy*this.out_depth)};MaxoutLayer.prototype={forward:function(V,is_training){this.in_act=V;var N=this.out_depth;var V2=new Vol(this.out_sx,this.out_sy,this.out_depth,0);if(this.out_sx===1&&this.out_sy===1){for(var i=0;i<N;i++){var ix=i*this.group_size;var a=V.w[ix];var ai=0;for(var j=1;j<this.group_size;j++){var a2=V.w[ix+j];if(a2>a){a=a2;ai=j}}V2.w[i]=a;this.switches[i]=ix+ai}}else{var n=0;for(var x=0;x<V.sx;x++){for(var y=0;y<V.sy;y++){for(var i=0;i<N;i++){var ix=i*this.group_size;var a=V.get(x,y,ix);var ai=0;for(var j=1;j<this.group_size;j++){var a2=V.get(x,y,ix+j);if(a2>a){a=a2;ai=j}}V2.set(x,y,i,a);this.switches[n]=ix+ai;n++}}}}this.out_act=V2;return this.out_act},backward:function(){var V=this.in_act;var V2=this.out_act;var N=this.out_depth;V.dw=global.zeros(V.w.length);if(this.out_sx===1&&this.out_sy===1){for(var i=0;i<N;i++){var chain_grad=V2.dw[i];V.dw[this.switches[i]]=chain_grad}}else{var n=0;for(var x=0;x<V2.sx;x++){for(var y=0;y<V2.sy;y++){for(var i=0;i<N;i++){var chain_grad=V2.get_grad(x,y,i);V.set_grad(x,y,this.switches[n],chain_grad);n++}}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;json.group_size=this.group_size;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type;this.group_size=json.group_size;this.switches=global.zeros(this.group_size)}};function tanh(x){var y=Math.exp(2*x);return(y-1)/(y+1)}var TanhLayer=function(opt){var opt=opt||{};this.out_sx=opt.in_sx;this.out_sy=opt.in_sy;this.out_depth=opt.in_depth;this.layer_type="tanh"};TanhLayer.prototype={forward:function(V,is_training){this.in_act=V;var V2=V.cloneAndZero();var N=V.w.length;for(var i=0;i<N;i++){V2.w[i]=tanh(V.w[i])}this.out_act=V2;return this.out_act},backward:function(){var V=this.in_act;var V2=this.out_act;var N=V.w.length;V.dw=global.zeros(N);for(var i=0;i<N;i++){var v2wi=V2.w[i];V.dw[i]=(1-v2wi*v2wi)*V2.dw[i]}},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type}};global.TanhLayer=TanhLayer;global.MaxoutLayer=MaxoutLayer;global.ReluLayer=ReluLayer;global.SigmoidLayer=SigmoidLayer})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var DropoutLayer=function(opt){var opt=opt||{};this.out_sx=opt.in_sx;this.out_sy=opt.in_sy;this.out_depth=opt.in_depth;this.layer_type="dropout";this.drop_prob=typeof opt.drop_prob!=="undefined"?opt.drop_prob:.5;this.dropped=global.zeros(this.out_sx*this.out_sy*this.out_depth)};DropoutLayer.prototype={forward:function(V,is_training){this.in_act=V;if(typeof is_training==="undefined"){is_training=false}var V2=V.clone();var N=V.w.length;if(is_training){for(var i=0;i<N;i++){if(Math.random()<this.drop_prob){V2.w[i]=0;this.dropped[i]=true}else{this.dropped[i]=false}}}else{for(var i=0;i<N;i++){V2.w[i]*=this.drop_prob}}this.out_act=V2;return this.out_act},backward:function(){var V=this.in_act;var chain_grad=this.out_act;var N=V.w.length;V.dw=global.zeros(N);for(var i=0;i<N;i++){if(!this.dropped[i]){V.dw[i]=chain_grad.dw[i]}}},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;json.drop_prob=this.drop_prob;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type;this.drop_prob=json.drop_prob}};global.DropoutLayer=DropoutLayer})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var LocalResponseNormalizationLayer=function(opt){var opt=opt||{};this.k=opt.k;this.n=opt.n;this.alpha=opt.alpha;this.beta=opt.beta;this.out_sx=opt.in_sx;this.out_sy=opt.in_sy;this.out_depth=opt.in_depth;this.layer_type="lrn";if(this.n%2===0){console.log("WARNING n should be odd for LRN layer")}};LocalResponseNormalizationLayer.prototype={forward:function(V,is_training){this.in_act=V;var A=V.cloneAndZero();this.S_cache_=V.cloneAndZero();var n2=Math.floor(this.n/2);for(var x=0;x<V.sx;x++){for(var y=0;y<V.sy;y++){for(var i=0;i<V.depth;i++){var ai=V.get(x,y,i);var den=0;for(var j=Math.max(0,i-n2);j<=Math.min(i+n2,V.depth-1);j++){var aa=V.get(x,y,j);den+=aa*aa}den*=this.alpha/this.n;den+=this.k;this.S_cache_.set(x,y,i,den);den=Math.pow(den,this.beta);A.set(x,y,i,ai/den)}}}this.out_act=A;return this.out_act},backward:function(){var V=this.in_act;V.dw=global.zeros(V.w.length);var A=this.out_act;var n2=Math.floor(this.n/2);for(var x=0;x<V.sx;x++){for(var y=0;y<V.sy;y++){for(var i=0;i<V.depth;i++){var chain_grad=this.out_act.get_grad(x,y,i);var S=this.S_cache_.get(x,y,i);var SB=Math.pow(S,this.beta);var SB2=SB*SB;for(var j=Math.max(0,i-n2);j<=Math.min(i+n2,V.depth-1);j++){var aj=V.get(x,y,j);var g=-aj*this.beta*Math.pow(S,this.beta-1)*this.alpha/this.n*2*aj;if(j===i)g+=SB;g/=SB2;g*=chain_grad;V.add_grad(x,y,j,g)}}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.k=this.k;json.n=this.n;json.alpha=this.alpha;json.beta=this.beta;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.out_depth=this.out_depth;json.layer_type=this.layer_type;return json},fromJSON:function(json){this.k=json.k;this.n=json.n;this.alpha=json.alpha;this.beta=json.beta;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.out_depth=json.out_depth;this.layer_type=json.layer_type}};global.LocalResponseNormalizationLayer=LocalResponseNormalizationLayer})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var QuadTransformLayer=function(opt){var opt=opt||{};this.out_sx=opt.in_sx;this.out_sy=opt.in_sy;this.out_depth=opt.in_depth+opt.in_depth*opt.in_depth;this.layer_type="quadtransform"};QuadTransformLayer.prototype={forward:function(V,is_training){this.in_act=V;var N=this.out_depth;var Ni=V.depth;var V2=new Vol(this.out_sx,this.out_sy,this.out_depth,0);for(var x=0;x<V.sx;x++){for(var y=0;y<V.sy;y++){for(var i=0;i<N;i++){if(i<Ni){V2.set(x,y,i,V.get(x,y,i))}else{var i0=Math.floor((i-Ni)/Ni);var i1=i-Ni-i0*Ni;V2.set(x,y,i,V.get(x,y,i0)*V.get(x,y,i1))}}}}this.out_act=V2;return this.out_act},backward:function(){var V=this.in_act;V.dw=global.zeros(V.w.length);var V2=this.out_act;var N=this.out_depth;var Ni=V.depth;for(var x=0;x<V.sx;x++){for(var y=0;y<V.sy;y++){for(var i=0;i<N;i++){var chain_grad=V2.get_grad(x,y,i);if(i<Ni){V.add_grad(x,y,i,chain_grad)}else{var i0=Math.floor((i-Ni)/Ni);var i1=i-Ni-i0*Ni;V.add_grad(x,y,i0,V.get(x,y,i1)*chain_grad);V.add_grad(x,y,i1,V.get(x,y,i0)*chain_grad)}}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var json={};json.out_depth=this.out_depth;json.out_sx=this.out_sx;json.out_sy=this.out_sy;json.layer_type=this.layer_type;return json},fromJSON:function(json){this.out_depth=json.out_depth;this.out_sx=json.out_sx;this.out_sy=json.out_sy;this.layer_type=json.layer_type}};global.QuadTransformLayer=QuadTransformLayer})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var Net=function(options){this.layers=[]};Net.prototype={makeLayers:function(defs){if(defs.length<2){console.log("ERROR! For now at least have input and softmax layers.")}if(defs[0].type!=="input"){console.log("ERROR! For now first layer should be input.")}var desugar=function(){var new_defs=[];for(var i=0;i<defs.length;i++){var def=defs[i];if(def.type==="softmax"||def.type==="svm"){new_defs.push({type:"fc",num_neurons:def.num_classes})}if(def.type==="regression"){new_defs.push({type:"fc",num_neurons:def.num_neurons})}if((def.type==="fc"||def.type==="conv")&&typeof def.bias_pref==="undefined"){def.bias_pref=0;if(typeof def.activation!=="undefined"&&def.activation==="relu"){def.bias_pref=.1}}if(typeof def.tensor!=="undefined"){if(def.tensor){new_defs.push({type:"quadtransform"})}}new_defs.push(def);if(typeof def.activation!=="undefined"){if(def.activation==="relu"){new_defs.push({type:"relu"})}else if(def.activation==="sigmoid"){new_defs.push({type:"sigmoid"})}else if(def.activation==="tanh"){new_defs.push({type:"tanh"})}else if(def.activation==="maxout"){var gs=def.group_size!=="undefined"?def.group_size:2;new_defs.push({type:"maxout",group_size:gs})}else{console.log("ERROR unsupported activation "+def.activation)}}if(typeof def.drop_prob!=="undefined"&&def.type!=="dropout"){new_defs.push({type:"dropout",drop_prob:def.drop_prob})}}return new_defs};defs=desugar(defs);this.layers=[];for(var i=0;i<defs.length;i++){var def=defs[i];if(i>0){var prev=this.layers[i-1];def.in_sx=prev.out_sx;def.in_sy=prev.out_sy;def.in_depth=prev.out_depth}switch(def.type){case"fc":this.layers.push(new global.FullyConnLayer(def));break;case"lrn":this.layers.push(new global.LocalResponseNormalizationLayer(def));break;case"dropout":this.layers.push(new global.DropoutLayer(def));break;case"input":this.layers.push(new global.InputLayer(def));break;case"softmax":this.layers.push(new global.SoftmaxLayer(def));break;case"regression":this.layers.push(new global.RegressionLayer(def));break;case"conv":this.layers.push(new global.ConvLayer(def));break;case"pool":this.layers.push(new global.PoolLayer(def));break;case"relu":this.layers.push(new global.ReluLayer(def));break;case"sigmoid":this.layers.push(new global.SigmoidLayer(def));break;case"tanh":this.layers.push(new global.TanhLayer(def));break;case"maxout":this.layers.push(new global.MaxoutLayer(def));break;case"quadtransform":this.layers.push(new global.QuadTransformLayer(def));break;case"svm":this.layers.push(new global.SVMLayer(def));break;default:console.log("ERROR: UNRECOGNIZED LAYER TYPE!")}}},forward:function(V,is_training){if(typeof is_training==="undefined")is_training=false;var act=this.layers[0].forward(V,is_training);for(var i=1;i<this.layers.length;i++){act=this.layers[i].forward(act,is_training)}return act},backward:function(y){var N=this.layers.length;var loss=this.layers[N-1].backward(y);for(var i=N-2;i>=0;i--){this.layers[i].backward()}return loss},getParamsAndGrads:function(){var response=[];for(var i=0;i<this.layers.length;i++){var layer_reponse=this.layers[i].getParamsAndGrads();for(var j=0;j<layer_reponse.length;j++){response.push(layer_reponse[j])}}return response},getPrediction:function(){var S=this.layers[this.layers.length-1];var p=S.out_act.w;var maxv=p[0];var maxi=0;for(var i=1;i<p.length;i++){if(p[i]>maxv){maxv=p[i];maxi=i}}return maxi},toJSON:function(){var json={};json.layers=[];for(var i=0;i<this.layers.length;i++){json.layers.push(this.layers[i].toJSON())}return json},fromJSON:function(json){this.layers=[];for(var i=0;i<json.layers.length;i++){var Lj=json.layers[i];var t=Lj.layer_type;var L;if(t==="input"){L=new global.InputLayer}if(t==="relu"){L=new global.ReluLayer}if(t==="sigmoid"){L=new global.SigmoidLayer}if(t==="tanh"){L=new global.TanhLayer}if(t==="dropout"){L=new global.DropoutLayer}if(t==="conv"){L=new global.ConvLayer}if(t==="pool"){L=new global.PoolLayer}if(t==="lrn"){L=new global.LocalResponseNormalizationLayer}if(t==="softmax"){L=new global.SoftmaxLayer}if(t==="regression"){L=new global.RegressionLayer}if(t==="fc"){L=new global.FullyConnLayer}if(t==="maxout"){L=new global.MaxoutLayer}if(t==="quadtransform"){L=new global.QuadTransformLayer}if(t==="svm"){L=new global.SVMLayer}L.fromJSON(Lj);this.layers.push(L)}}};global.Net=Net})(convnetjs);(function(global){"use strict";var Vol=global.Vol;var Trainer=function(net,options){this.net=net;var options=options||{};this.learning_rate=typeof options.learning_rate!=="undefined"?options.learning_rate:.01;this.l1_decay=typeof options.l1_decay!=="undefined"?options.l1_decay:0;this.l2_decay=typeof options.l2_decay!=="undefined"?options.l2_decay:0;this.batch_size=typeof options.batch_size!=="undefined"?options.batch_size:1;this.method=typeof options.method!=="undefined"?options.method:"sgd";this.momentum=typeof options.momentum!=="undefined"?options.momentum:.9;this.ro=typeof options.ro!=="undefined"?options.ro:.95;this.eps=typeof options.eps!=="undefined"?options.eps:1e-6;this.k=0;this.gsum=[];this.xsum=[]};Trainer.prototype={train:function(x,y){var start=(new Date).getTime();this.net.forward(x,true);var end=(new Date).getTime();var fwd_time=end-start;var start=(new Date).getTime();var cost_loss=this.net.backward(y);var l2_decay_loss=0;var l1_decay_loss=0;var end=(new Date).getTime();var bwd_time=end-start;this.k++;if(this.k%this.batch_size===0){var pglist=this.net.getParamsAndGrads();if(this.gsum.length===0&&(this.method!=="sgd"||this.momentum>0)){for(var i=0;i<pglist.length;i++){this.gsum.push(global.zeros(pglist[i].params.length));if(this.method==="adadelta"){this.xsum.push(global.zeros(pglist[i].params.length))}else{this.xsum.push([])}}}for(var i=0;i<pglist.length;i++){var pg=pglist[i];var p=pg.params;var g=pg.grads;var l2_decay_mul=typeof pg.l2_decay_mul!=="undefined"?pg.l2_decay_mul:1;var l1_decay_mul=typeof pg.l1_decay_mul!=="undefined"?pg.l1_decay_mul:1;var l2_decay=this.l2_decay*l2_decay_mul;var l1_decay=this.l1_decay*l1_decay_mul;var plen=p.length;for(var j=0;j<plen;j++){l2_decay_loss+=l2_decay*p[j]*p[j]/2;l1_decay_loss+=l1_decay*Math.abs(p[j]);var l1grad=l1_decay*(p[j]>0?1:-1);var l2grad=l2_decay*p[j];var gij=(l2grad+l1grad+g[j])/this.batch_size;var gsumi=this.gsum[i];var xsumi=this.xsum[i];if(this.method==="adagrad"){gsumi[j]=gsumi[j]+gij*gij;var dx=-this.learning_rate/Math.sqrt(gsumi[j]+this.eps)*gij;p[j]+=dx}else if(this.method==="windowgrad"){gsumi[j]=this.ro*gsumi[j]+(1-this.ro)*gij*gij;var dx=-this.learning_rate/Math.sqrt(gsumi[j]+this.eps)*gij;p[j]+=dx}else if(this.method==="adadelta"){gsumi[j]=this.ro*gsumi[j]+(1-this.ro)*gij*gij;var dx=-Math.sqrt((xsumi[j]+this.eps)/(gsumi[j]+this.eps))*gij;xsumi[j]=this.ro*xsumi[j]+(1-this.ro)*dx*dx;p[j]+=dx}else{if(this.momentum>0){var dx=this.momentum*gsumi[j]-this.learning_rate*gij;gsumi[j]=dx;p[j]+=dx}else{p[j]+=-this.learning_rate*gij}}g[j]=0}}}return{fwd_time:fwd_time,bwd_time:bwd_time,l2_decay_loss:l2_decay_loss,l1_decay_loss:l1_decay_loss,cost_loss:cost_loss,softmax_loss:cost_loss,loss:cost_loss+l1_decay_loss+l2_decay_loss}}};global.Trainer=Trainer;global.SGDTrainer=Trainer})(convnetjs);(function(global){"use strict";var randf=global.randf;var randi=global.randi;var Net=global.Net;var Trainer=global.Trainer;var maxmin=global.maxmin;var randperm=global.randperm;var weightedSample=global.weightedSample;var getopt=global.getopt;var arrUnique=global.arrUnique;var MagicNet=function(data,labels,opt){var opt=opt||{};if(typeof data==="undefined"){data=[]}if(typeof labels==="undefined"){labels=[]}this.data=data;this.labels=labels;this.train_ratio=getopt(opt,"train_ratio",.7);this.num_folds=getopt(opt,"num_folds",10);this.num_candidates=getopt(opt,"num_candidates",50);this.num_epochs=getopt(opt,"num_epochs",50);this.ensemble_size=getopt(opt,"ensemble_size",10);this.batch_size_min=getopt(opt,"batch_size_min",10);this.batch_size_max=getopt(opt,"batch_size_max",300);this.l2_decay_min=getopt(opt,"l2_decay_min",-4);this.l2_decay_max=getopt(opt,"l2_decay_max",2);this.learning_rate_min=getopt(opt,"learning_rate_min",-4);this.learning_rate_max=getopt(opt,"learning_rate_max",0);this.momentum_min=getopt(opt,"momentum_min",.9);this.momentum_max=getopt(opt,"momentum_max",.9);this.neurons_min=getopt(opt,"neurons_min",5);this.neurons_max=getopt(opt,"neurons_max",30);this.folds=[];this.candidates=[];this.evaluated_candidates=[];this.unique_labels=arrUnique(labels);this.iter=0;this.foldix=0;this.finish_fold_callback=null;this.finish_batch_callback=null;if(this.data.length>0){this.sampleFolds();this.sampleCandidates()}};MagicNet.prototype={sampleFolds:function(){var N=this.data.length;var num_train=Math.floor(this.train_ratio*N);this.folds=[];for(var i=0;i<this.num_folds;i++){var p=randperm(N);this.folds.push({train_ix:p.slice(0,num_train),test_ix:p.slice(num_train,N)})}},sampleCandidate:function(){var input_depth=this.data[0].w.length;var num_classes=this.unique_labels.length;var layer_defs=[];layer_defs.push({type:"input",out_sx:1,out_sy:1,out_depth:input_depth});var nl=weightedSample([0,1,2,3],[.2,.3,.3,.2]);for(var q=0;q<nl;q++){var ni=randi(this.neurons_min,this.neurons_max);var act=["tanh","maxout","relu"][randi(0,3)];if(randf(0,1)<.5){var dp=Math.random();layer_defs.push({type:"fc",num_neurons:ni,activation:act,drop_prob:dp})}else{layer_defs.push({type:"fc",num_neurons:ni,activation:act})}}layer_defs.push({type:"softmax",num_classes:num_classes});var net=new Net;net.makeLayers(layer_defs);var bs=randi(this.batch_size_min,this.batch_size_max);var l2=Math.pow(10,randf(this.l2_decay_min,this.l2_decay_max));var lr=Math.pow(10,randf(this.learning_rate_min,this.learning_rate_max));var mom=randf(this.momentum_min,this.momentum_max);var tp=randf(0,1);var trainer_def;if(tp<.33){trainer_def={method:"adadelta",batch_size:bs,l2_decay:l2}}else if(tp<.66){trainer_def={method:"adagrad",learning_rate:lr,batch_size:bs,l2_decay:l2}}else{trainer_def={method:"sgd",learning_rate:lr,momentum:mom,batch_size:bs,l2_decay:l2}}var trainer=new Trainer(net,trainer_def);var cand={};cand.acc=[];cand.accv=0;cand.layer_defs=layer_defs;cand.trainer_def=trainer_def;cand.net=net;cand.trainer=trainer;return cand},sampleCandidates:function(){this.candidates=[];for(var i=0;i<this.num_candidates;i++){var cand=this.sampleCandidate();this.candidates.push(cand)}},step:function(){this.iter++;var fold=this.folds[this.foldix];var dataix=fold.train_ix[randi(0,fold.train_ix.length)];for(var k=0;k<this.candidates.length;k++){var x=this.data[dataix];var l=this.labels[dataix];this.candidates[k].trainer.train(x,l)}var lastiter=this.num_epochs*fold.train_ix.length;if(this.iter>=lastiter){var val_acc=this.evalValErrors();for(var k=0;k<this.candidates.length;k++){var c=this.candidates[k];c.acc.push(val_acc[k]);c.accv+=val_acc[k]}this.iter=0;this.foldix++;if(this.finish_fold_callback!==null){this.finish_fold_callback()}if(this.foldix>=this.folds.length){for(var k=0;k<this.candidates.length;k++){this.evaluated_candidates.push(this.candidates[k])}this.evaluated_candidates.sort(function(a,b){return a.accv/a.acc.length>b.accv/b.acc.length?-1:1});if(this.evaluated_candidates.length>3*this.ensemble_size){this.evaluated_candidates=this.evaluated_candidates.slice(0,3*this.ensemble_size)}if(this.finish_batch_callback!==null){this.finish_batch_callback()}this.sampleCandidates();this.foldix=0}else{for(var k=0;k<this.candidates.length;k++){var c=this.candidates[k];var net=new Net;net.makeLayers(c.layer_defs);var trainer=new Trainer(net,c.trainer_def);c.net=net;c.trainer=trainer}}}},evalValErrors:function(){var vals=[];var fold=this.folds[this.foldix];for(var k=0;k<this.candidates.length;k++){var net=this.candidates[k].net;var v=0;for(var q=0;q<fold.test_ix.length;q++){var x=this.data[fold.test_ix[q]];var l=this.labels[fold.test_ix[q]];net.forward(x);var yhat=net.getPrediction();v+=yhat===l?1:0}v/=fold.test_ix.length;vals.push(v)}return vals},predict_soft:function(data){var nv=Math.min(this.ensemble_size,this.evaluated_candidates.length);if(nv===0){return new convnetjs.Vol(0,0,0)}var xout,n;for(var j=0;j<nv;j++){var net=this.evaluated_candidates[j].net;var x=net.forward(data);if(j===0){xout=x;n=x.w.length}else{for(var d=0;d<n;d++){xout.w[d]+=x.w[d]}}}for(var d=0;d<n;d++){xout.w[d]/=n}return xout},predict:function(data){var xout=this.predict_soft(data);if(xout.w.length!==0){
var stats=maxmin(xout.w);var predicted_label=stats.maxi}else{var predicted_label=-1}return predicted_label},toJSON:function(){var nv=Math.min(this.ensemble_size,this.evaluated_candidates.length);var json={};json.nets=[];for(var i=0;i<nv;i++){json.nets.push(this.evaluated_candidates[i].net.toJSON())}return json},fromJSON:function(json){this.ensemble_size=json.nets.length;this.evaluated_candidates=[];for(var i=0;i<this.ensemble_size;i++){var net=new Net;net.fromJSON(json.nets[i]);var dummy_candidate={};dummy_candidate.net=net;this.evaluated_candidates.push(dummy_candidate)}},onFinishFold:function(f){this.finish_fold_callback=f},onFinishBatch:function(f){this.finish_batch_callback=f}};global.MagicNet=MagicNet})(convnetjs);(function(lib){"use strict";if(typeof module==="undefined"||typeof module.exports==="undefined"){window.jsfeat=lib}else{module.exports=lib}})(convnetjs)},{}],"node-mind":[function(require,module,exports){var sigmoidPrime=require("sigmoid-prime");var Emitter=require("emitter-component");var htanPrime=require("htan-prime");var Matrix=require("node-matrix");var sigmoid=require("sigmoid");var sample=require("samples");var htan=require("htan");var scalar=Matrix.multiplyScalar;var dot=Matrix.multiplyElements;var multiply=Matrix.multiply;var subtract=Matrix.subtract;var add=Matrix.add;module.exports=Mind;function Mind(opts){if(!(this instanceof Mind))return new Mind(opts);opts=opts||{};opts.activator==="sigmoid"?(this.activate=sigmoid,this.activatePrime=sigmoidPrime):(this.activate=htan,this.activatePrime=htanPrime);this.learningRate=opts.learningRate||.7;this.iterations=opts.iterations||1e4;this.hiddenLayers=opts.hiddenLayers||1;this.hiddenUnits=opts.hiddenUnits||3}Emitter(Mind.prototype);Mind.prototype.learn=function(examples){examples=normalize(examples);this.setup(examples);for(var i=0;i<this.iterations;i++){var results=this.forward(examples);var errors=this.back(examples,results);this.emit("data",i,errors,results)}return this};Mind.prototype.setup=function(examples){this.weights=[];this.weights.push(Matrix({rows:examples.input[0].length,columns:this.hiddenUnits,values:sample}));for(var i=1;i<this.hiddenLayers;i++){this.weights.push(Matrix({rows:this.hiddenUnits,columns:this.hiddenUnits,values:sample}))}this.weights.push(Matrix({rows:this.hiddenUnits,columns:examples.output[0].length,values:sample}))};Mind.prototype.forward=function(examples){var activate=this.activate;var weights=this.weights;var results=[];function sum(w,i){var res={};res.sum=multiply(w,i);res.result=res.sum.transform(activate);return res}results.push(sum(weights[0],examples.input));for(var i=1;i<this.hiddenLayers;i++){results.push(sum(weights[i],results[i-1].result))}results.push(sum(weights[weights.length-1],results[results.length-1].result));return results};Mind.prototype.back=function(examples,results){var activatePrime=this.activatePrime;var hiddenLayers=this.hiddenLayers;var learningRate=this.learningRate;var weights=this.weights;var error=subtract(examples.output,results[results.length-1].result);var delta=dot(results[results.length-1].sum.transform(activatePrime),error);var changes=scalar(multiply(delta,results[0].result.transpose()),learningRate);weights[weights.length-1]=add(weights[weights.length-1],changes);for(var i=1;i<hiddenLayers;i++){delta=dot(multiply(weights[weights.length-i].transpose(),delta),results[results.length-(i+1)].sum.transform(activatePrime));changes=scalar(multiply(delta,results[results.length-(i+1)].result.transpose()),learningRate);weights[weights.length-(i+1)]=add(weights[weights.length-(i+1)],changes)}delta=dot(multiply(weights[1].transpose(),delta),results[0].sum.transform(activatePrime));changes=scalar(multiply(delta,examples.input.transpose()),learningRate);weights[0]=add(weights[0],changes);return error};Mind.prototype.predict=function(input){var results=this.forward({input:Matrix([input])});return results[results.length-1].result[0]};Mind.prototype.upload=function(weights){this.weights=weights;return this};Mind.prototype.download=function(){return this.weights};function normalize(data){var ret={input:[],output:[]};for(var i=0;i<data.length;i++){var datum=data[i];ret.output.push(datum.output);ret.input.push(datum.input)}ret.output=Matrix(ret.output);ret.input=Matrix(ret.input);return ret}},{"emitter-component":30,htan:32,"htan-prime":31,"node-matrix":34,samples:35,sigmoid:37,"sigmoid-prime":36}],synaptic:[function(require,module,exports){var Synaptic={Neuron:require("./neuron"),Layer:require("./layer"),Network:require("./network"),Trainer:require("./trainer"),Architect:require("./architect")};if(typeof define!=="undefined"&&define.amd){define([],function(){return Synaptic})}if(typeof module!=="undefined"&&module.exports){module.exports=Synaptic}if(typeof window=="object"){(function(){var oldSynaptic=window["synaptic"];Synaptic.ninja=function(){window["synaptic"]=oldSynaptic;return Synaptic}})();window["synaptic"]=Synaptic}},{"./architect":38,"./layer":39,"./network":40,"./neuron":41,"./trainer":42}]},{},[]);
